<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/24/qq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/24/qq/" class="post-title-link" itemprop="url">qq</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-11-24 22:52:40 / Modified: 22:55:39" itemprop="dateCreated datePublished" datetime="2023-11-24T22:52:40+08:00">2023-11-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img src="/2023/11/24/qq/quicksave.png" class="">
<h3 id="ijefifjieo"><a href="#ijefifjieo" class="headerlink" title="ijefifjieo"></a>ijefifjieo</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/19/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/19/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-19 15:44:13" itemprop="dateCreated datePublished" datetime="2023-11-19T15:44:13+08:00">2023-11-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/27/practices-of-refactoring-to-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/27/practices-of-refactoring-to-patterns/" class="post-title-link" itemprop="url">Practices of Refactoring To Patterns</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-27 00:00:08" itemprop="dateCreated datePublished" datetime="2023-03-27T00:00:08+08:00">2023-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-24 21:50:21" itemprop="dateModified" datetime="2023-11-24T21:50:21+08:00">2023-11-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://geekcodeparadise.com/wp-content/uploads/2023/03/kaleidico-3V8xo5Gbusk-unsplash-1024x683.jpg" alt="refactoring"></p>
<p>(Photo from Upsplash: <a target="_blank" rel="noopener" href="https://unsplash.com/photos/3V8xo5Gbusk">https://unsplash.com/photos/3V8xo5Gbusk</a><a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/moving-boxes-mover-moving-truck-3671446/">)</a></p>
<h1 id="Refactoring-To-Patterns"><a href="#Refactoring-To-Patterns" class="headerlink" title="Refactoring To Patterns"></a>Refactoring To Patterns</h1><p>My practices of the book Refactoring To Patterns.</p>
<p>Joshua Kerievsky’s book <a target="_blank" rel="noopener" href="https://amzn.to/3FNMrhJ">Refactoring to Patterns</a>.</p>
<p>The code samples are placed in my <a target="_blank" rel="noopener" href="https://github.com/u8989332/RefactoringToPatterns_Practice">Github</a>.</p>
<p>The content of the book is listed from chapter 6 to chapter 11 and maps to my Github subfolders:</p>
<h2 id="Chapter-6-Creation"><a href="#Chapter-6-Creation" class="headerlink" title="Chapter 6 Creation"></a>Chapter 6 Creation</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/03/27/practices-of-refactoring-to-patterns/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/09/refactoring-chapter-10-simplifying-conditional-logic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/09/refactoring-chapter-10-simplifying-conditional-logic/" class="post-title-link" itemprop="url">Simplifying Conditional Logic</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-09 14:30:09" itemprop="dateCreated datePublished" datetime="2022-04-09T14:30:09+08:00">2022-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This article references the chapter 10 “ Simplifying Conditional Logic “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. Author had highlighted many important refactorings in this chapter.</p>
<p>I use .NET C# to practice with these refactorings and upload to Github.</p>
<p><img src="https://geekcodeparadise.com/wp-content/uploads/2022/04/direction-2320124_1920-1024x1024.jpg" alt="Simplifying Conditional Logic"></p>
<p>(Photo from Pixabay: <a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/direction-path-decision-goal-2320124/">https://pixabay.com/illustrations/direction-path-decision-goal-2320124/</a><a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/moving-boxes-mover-moving-truck-3671446/">)</a></p>
<h2 id="Decompose-Conditional"><a href="#Decompose-Conditional" class="headerlink" title="Decompose Conditional"></a>Decompose Conditional</h2><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If the condition is complex, extract the condition and its branches as functions.</li>
</ul>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch10.Simplifying%20Conditional%20Logic/Decompose%20Conditional">Github</a></p>
<hr>
<h2 id="Consolidate-Conditional-Expression"><a href="#Consolidate-Conditional-Expression" class="headerlink" title="Consolidate Conditional Expression"></a>Consolidate Conditional Expression</h2><h5 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Some conditions can be reduced into an “Ands” or “Ors” expression. Then this “Ands” or “Ors” expression can be extracted as a function.</li>
<li>Sequences combine with Or, nested if statements combine with And.</li>
<li>If the conditions have side-effect, use <strong>Separate Query from Modifier</strong> to process it.</li>
</ul>
<h5 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>An Ors example</li>
<li>An Ands example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch10.Simplifying%20Conditional%20Logic/Consolidate%20Conditional%20Expression">Github</a></p>
<hr>
<h2 id="Replace-Nested-Conditional-with-Guard-Clauses"><a href="#Replace-Nested-Conditional-with-Guard-Clauses" class="headerlink" title="Replace Nested Conditional with Guard Clauses"></a>Replace Nested Conditional with Guard Clauses</h2><h5 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If a condition is not normal, check it and return if it’s true. This check is a <strong>Guard Clause</strong></li>
<li>Guard Clause means that it is not the core logic of the function But if it happens, it does the necessary cleaning job to exit the function.</li>
<li>Choose the outermost condition and replace it by Guard Clause. If some Guard Clauses have the same result, use <strong>Consolidate Conditional Expression</strong>.</li>
</ul>
<h5 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>An simple example</li>
<li>Reversing the Conditions example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch10.Simplifying%20Conditional%20Logic/Replace%20Nested%20Conditional%20with%20Guard%20Clauses">Github</a></p>
<h2 id="Replace-Conditional-with-Polymorphism"><a href="#Replace-Conditional-with-Polymorphism" class="headerlink" title="Replace Conditional with Polymorphism"></a>Replace Conditional with Polymorphism</h2><hr>
<h5 id="Tips-3"><a href="#Tips-3" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If a condition is complex, split it by using polymorphism and make its logic clear</li>
<li>For a variation condition, we put the basic logic into a superclass, and put the variation logic into derived class.</li>
<li>Don’t abuse using polymorphism when the condition is simple.</li>
<li>If the current class has no polymorphism, we create a <strong>factory function</strong> to return its object instance. Then we put every condition logic into derived class.</li>
</ul>
<h5 id="Examples-3"><a href="#Examples-3" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>An simple example</li>
<li>Using Polymorphism for Variation</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch10.Simplifying%20Conditional%20Logic/Replace%20Conditional%20with%20Polymorphism">Github</a></p>
<hr>
<h2 id="Introduce-Special-Case"><a href="#Introduce-Special-Case" class="headerlink" title="Introduce Special Case"></a>Introduce Special Case</h2><h5 id="Tips-4"><a href="#Tips-4" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If clients always check a structure’s value, we separate this check into a special-case.</li>
<li>NullObject is a common pattern for null value.</li>
<li>Add the special-case check property to the target structure. Use <strong>Combine Functions into Class</strong> or <strong>Combine Functions into Transform</strong> to move the special-case logic into a new class. Then the previous special-case check property will return it when check triggers.</li>
</ul>
<h5 id="Examples-4"><a href="#Examples-4" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A Class example</li>
<li>An Object Literal example</li>
<li>A Transform example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch10.Simplifying%20Conditional%20Logic/Introduce%20Special%20Case">Github</a></p>
<hr>
<h2 id="Introduce-Assertion"><a href="#Introduce-Assertion" class="headerlink" title="Introduce Assertion"></a>Introduce Assertion</h2><h5 id="Tips-5"><a href="#Tips-5" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Assertion definitely marks the assumption(expression). Assertion avoid programmer’s error.</li>
<li>Don’t abuse assertion. We only use it when the expression must be true.</li>
</ul>
<h5 id="Examples-5"><a href="#Examples-5" class="headerlink" title="Examples:"></a>Examples:</h5><p>&#x2F;&#x2F; before refactoring<br>public void SaveMoneyIntoAccount(decimal money)<br>{<br>     acount +&#x3D; money;<br>}</p>
<p>&#x2F;&#x2F; after refactoring<br>public void SaveMoneyIntoAccount(decimal money)<br>{<br>     Debug.Assert(money &gt; 0);<br>     acount +&#x3D; money;<br>}</p>
<hr>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This chapter introduces me how to simplify conditional logic. I had ever written complex conditional branches and they were very ugly long…… I had no idea to reafactor them until I read this chapter. If you want to learn detailed motivation and mechanics, study the chapter 10 “ Simplifying Conditional Logic “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. and it improves our programmer’s ability.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/26/refactoring-chapter-9-organizing-data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/26/refactoring-chapter-9-organizing-data/" class="post-title-link" itemprop="url">Organizing Data</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-26 15:54:47" itemprop="dateCreated datePublished" datetime="2022-03-26T15:54:47+08:00">2022-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This article references the chapter 9 “ Organizing Data “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. Author had highlighted many important refactorings in this chapter.</p>
<p>I use .NET C# to practice with these refactorings and upload to Github.</p>
<p><img src="https://geekcodeparadise.com/wp-content/uploads/2022/03/cabinet-3283536_960_720.jpg" alt="organizing data"></p>
<p>(Photo from Pixabay: <a target="_blank" rel="noopener" href="https://pixabay.com/photos/cabinet-drawer-wood-catalogue-3283536/">https://pixabay.com/photos/cabinet-drawer-wood-catalogue-3283536/</a><a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/moving-boxes-mover-moving-truck-3671446/">)</a></p>
<hr>
<h4 id="Split-Variable"><a href="#Split-Variable" class="headerlink" title="Split Variable"></a>Split Variable</h4><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Loop variable and collecting variable are special. They are assigned value many times.</li>
<li>Other variable is responsible for one thing. It should be assigned value one time.</li>
<li>If some variable is assigned many times, we should split it into different variables.</li>
</ul>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
<li>Assigning to an Input Parameter</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch9.Organizing%20Data/Split%20Variable">Github</a></p>
<hr>
<h4 id="Rename-Field"><a href="#Rename-Field" class="headerlink" title="Rename Field"></a>Rename Field</h4><h5 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>A field with good naming makes the developer clever about what the code does.</li>
<li>Field and accessors (getter&#x2F;setter) namings are important.</li>
<li>If a record is still not encapsulated, use <strong>Encapsulate Record</strong>.</li>
</ul>
<h5 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch9.Organizing%20Data/Rename%20Field">Github</a></p>
<hr>
<h4 id="Replace-Derived-Variable-with-Query"><a href="#Replace-Derived-Variable-with-Query" class="headerlink" title="Replace Derived Variable with Query"></a>Replace Derived Variable with Query</h4><h5 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>We should minimize the scope of mutable data at much as possible.</li>
<li>Use this skill to avoid “We update the source data but we forget to update the derived variable”</li>
</ul>
<h5 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
<li>More Than One Source</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch9.Organizing%20Data/Replace%20Derived%20Variable%20with%20Query">Github</a></p>
<hr>
<h4 id="Change-Reference-to-Value"><a href="#Change-Reference-to-Value" class="headerlink" title="Change Reference to Value"></a>Change Reference to Value</h4><h5 id="Tips-3"><a href="#Tips-3" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>A <a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/ValueObject.html">value object</a> is immutable. We can transfer this object into other logic without caring about modifying the object’s data.</li>
<li>If an object can be shared between many objects and they can see its modification, it should be a reference object.</li>
<li>Value object usually implements <strong>equals</strong> function.</li>
</ul>
<h5 id="Examples-3"><a href="#Examples-3" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
<li>More Than One Source</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch9.Organizing%20Data/Change%20Reference%20to%20Value">Github</a></p>
<hr>
<h4 id="Change-Reference-to-Value-1"><a href="#Change-Reference-to-Value-1" class="headerlink" title="Change Reference to Value"></a>Change Reference to Value</h4><h5 id="Tips-4"><a href="#Tips-4" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If a shared Value Object data needs update, we need to find all data copies and update them. Change it to Reference Object and the object’s update reflects on all clients.</li>
<li>Build a <a target="_blank" rel="noopener" href="https://martinfowler.com/eaaCatalog/repository.html">Repository</a> to manage the reference object. All clients find the reference objects by the repository.</li>
</ul>
<h5 id="Examples-4"><a href="#Examples-4" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch9.Organizing%20Data/Change%20Value%20to%20Reference">Github</a></p>
<hr>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>This chapter introduces me how to organize data. In ASP.NET MVC development, I have used Service&#x2F;Repository pattern to manage my data source. And I used the LINQ to perform <strong>Replace Derived Variable with Query</strong>. I have grown up to write better code when I study this refactoring chapter. If you want to learn detailed motivation and mechanics, study the chapter 9 “ Organizing Data “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. and it improves our programmer’s ability.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/10/refactoring-chapter-8-moving-features/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/10/refactoring-chapter-8-moving-features/" class="post-title-link" itemprop="url">Moving Features</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-10 00:09:11" itemprop="dateCreated datePublished" datetime="2022-03-10T00:09:11+08:00">2022-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This article references the chapter 8 “ Moving Features “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. Author had highlighted many important refactorings in this chapter.</p>
<p>I use .NET C# to practice with these refactorings and upload to Github.</p>
<p><img src="https://geekcodeparadise.com/wp-content/uploads/2022/03/moving-3671446_1920-1024x757.png" alt="Moving Features"></p>
<p>(Photo from Pixabay: <a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/moving-boxes-mover-moving-truck-3671446/">https://pixabay.com/illustrations/plumber-repair-tools-pipe-plunger-4427401/https://pixabay.com/illustrations/moving-boxes-mover-moving-truck-3671446/ )</a></p>
<h4 id="Move-Function"><a href="#Move-Function" class="headerlink" title="Move Function"></a>Move Function</h4><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If a nested function of a outer function may be used for other situations, move this nested function to a general scope.</li>
<li>If a function of a class is better for other class, move this function into the target class.</li>
</ul>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Moving a Nested Function to Top Level</li>
<li>Moving between Classes</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch8.Moving%20Features/Move%20Function">Github</a></p>
<h4 id="Move-Field"><a href="#Move-Field" class="headerlink" title="Move Field"></a>Move Field</h4><h5 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If other structures are modified after one field is modified, we should move this field into a central structure.</li>
<li>Field should be encapsulated, it means that we add get&#x2F;set accessors to encapsulate fields to avoid “Bare” record.</li>
</ul>
<h5 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
<li>Moving to a Shared Object</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch8.Moving%20Features/Move%20Field">Github</a></p>
<h4 id="Move-Statements-into-Function"><a href="#Move-Statements-into-Function" class="headerlink" title="Move Statements into Function"></a>Move Statements into Function</h4><h5 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some statement repeatably works on many places, we should move it into a function.</li>
</ul>
<h5 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch8.Moving%20Features/Move%20Statements%20into%20Function">Github</a></p>
<h4 id="Move-Statements-into-Callers"><a href="#Move-Statements-into-Callers" class="headerlink" title="Move Statements into Callers"></a>Move Statements into Callers</h4><h5 id="Tips-3"><a href="#Tips-3" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some statement are changed by callers in a function, we should extract it to each caller.</li>
</ul>
<h5 id="Examples-3"><a href="#Examples-3" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Just use the <strong>Move Statements into</strong> <strong>Function</strong> example from end to start</li>
</ul>
<h4 id="Replace-Inline-Code-with-Function-Call"><a href="#Replace-Inline-Code-with-Function-Call" class="headerlink" title="Replace Inline Code with Function Call"></a>Replace Inline Code with Function Call</h4><h5 id="Tips-4"><a href="#Tips-4" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some inline code has been implements in some function, replace it with the function.</li>
<li>A good naming function shows what the inline code outputs without understanding the implementation</li>
</ul>
<h5 id="Examples-4"><a href="#Examples-4" class="headerlink" title="Examples:"></a>Examples:</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before refactoring</span></span><br><span class="line"><span class="built_in">bool</span> hasMyFavoriteFruit = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> fruit <span class="keyword">in</span> basket)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(fruit == <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        hasMyFavoriteFruit  = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// after refactoring</span></span><br><span class="line"><span class="built_in">bool</span> hasMyFavoriteFruit = basket.Contains(<span class="string">&quot;Apple&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Slide-Statements"><a href="#Slide-Statements" class="headerlink" title="Slide Statements"></a>Slide Statements</h4><h5 id="Tips-5"><a href="#Tips-5" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Some variable declarations are placed together on the top of scope, but author recommends that he declares variable when only first time he uses it.</li>
<li>Some statement has side-effect. If we slide it without test, it may cause the error.</li>
<li>We can implement the statement (function) by using C<a target="_blank" rel="noopener" href="https://amzn.to/3ng73c5">ommand&#x2F;Query separation pattern</a> to avoid the side-effect.</li>
<li>This refactoring focuses on the change of the state. When we slide statement, <strong>Split Variable</strong> is a good method.</li>
</ul>
<h5 id="Examples-5"><a href="#Examples-5" class="headerlink" title="Examples:"></a>Examples:</h5><p>Sliding with Conditionals</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before refactoring</span></span><br><span class="line">Response result = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(connection.Status == Status.OK)</span><br><span class="line">&#123;</span><br><span class="line">    result = CreateSuccessMessage();</span><br><span class="line">    connectionResponses.Add(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    result = CreateFailsMessage();</span><br><span class="line">    connectionResponses.Add(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"><span class="comment">// after refactoring</span></span><br><span class="line">Response result = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(connection.Status == Status.OK)</span><br><span class="line">&#123;</span><br><span class="line">    result = CreateSuccessMessage();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    result = CreateFailsMessage();</span><br><span class="line">&#125;</span><br><span class="line">connectionResponses.Add(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>

<h4 id="Split-Loop"><a href="#Split-Loop" class="headerlink" title="Split Loop"></a>Split Loop</h4><h5 id="Tips-6"><a href="#Tips-6" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If a loop contains many independent works, split them into their own loop scope.</li>
<li>We use <strong>Move Statement</strong> to move related variable declaration near by the new loop.</li>
<li>Split loop can be extracted as a function.</li>
<li><strong>Replace Loop with Pipeline</strong> is a better implementation.</li>
</ul>
<h5 id="Examples-6"><a href="#Examples-6" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch8.Moving%20Features/Split%20Loop">Github</a></p>
<h4 id="Replace-Loop-with-Pipeline"><a href="#Replace-Loop-with-Pipeline" class="headerlink" title="Replace Loop with Pipeline"></a>Replace Loop with Pipeline</h4><h5 id="Tips-7"><a href="#Tips-7" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Collection Pipeline is a modern pattern. A pipeline receives a collection and process it with some operations and outputs a new collection.</li>
<li>JavaScript has map&#x2F;filter&#x2F;… pipeline functions, C# has LINQ (select&#x2F;where…).</li>
<li>Pipeline increases the code readability.</li>
</ul>
<h5 id="Examples-7"><a href="#Examples-7" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>A simple example</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch8.Moving%20Features/Replace%20Loop%20with%20Pipeline">Github</a></p>
<h4 id="Remove-Dead-Code"><a href="#Remove-Dead-Code" class="headerlink" title="Remove Dead Code"></a>Remove Dead Code</h4><h5 id="Tips-8"><a href="#Tips-8" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some code is not used ever, remove it to avoid confusing you&#x2F;your team members.</li>
<li>Version control can manage all code history. Make the good use of it.</li>
</ul>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>This chapter introduces me how to move the code logic greatly. In my early coding job, I used to write long logic function. And this function was gradually hard maintainable. I learned some like Moving Features skills to enhance the code but it still was not completed. I have grown up to write better code when I study this refactoring chapter. If you want to learn detailed motivation and mechanics, study the chapter 8 “ Moving Features “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. and it improves our programmer’s ability.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/refactoring-chapter-7-encapsulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/refactoring-chapter-7-encapsulation/" class="post-title-link" itemprop="url">Encapsulation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-13 19:21:49" itemprop="dateCreated datePublished" datetime="2022-02-13T19:21:49+08:00">2022-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This article references the chapter 7 “ Encapsulation “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. Author had highlighted many important refactorings in this chapter.</p>
<p>I use .NET C# to practice with these refactorings and upload to Github.</p>
<p><a target="_blank" rel="noopener" href="https://geekcodeparadise.com/wp-content/uploads/2022/02/archive-1850170_1920-1024x683.jpg"><img src="https://geekcodeparadise.com/wp-content/uploads/2022/02/archive-1850170_1920-1024x683.jpg" alt="Encapsulation"></a></p>
<p>(Photo from Pixabay: <a target="_blank" rel="noopener" href="https://pixabay.com/photos/archive-boxes-shelf-folders-1850170/">https://pixabay.com/illustrations/plumber-repair-tools-pipe-plunger-4427401/ )</a></p>
<h4 id="Encapsulate-Record"><a href="#Encapsulate-Record" class="headerlink" title="Encapsulate Record"></a>Encapsulate Record</h4><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>For mutable data, use Class object instead of Record.</li>
<li>If some record has nested data (list&#x2F;hash&#x2F;….), encapsulating this nested data is better.</li>
<li>Usually use a class to encapsulate the record and create the access methods in the class.</li>
<li>For nested data, we first focus on “Update Method”, then “Read Method” can return the copy &#x2F; readonly proxy of the data.</li>
<li>If a record’s field is also a complex structure, consider to use <strong><em>Encapsulate Record</em></strong> or <strong><em>Encapsulate Collection</em></strong>.</li>
</ul>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Encapsulation</li>
<li>Encapsulating a Nested Record</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Encapsulate%20Record">Github</a></p>
<h4 id="Encapsulate-Collection"><a href="#Encapsulate-Collection" class="headerlink" title="Encapsulate Collection"></a>Encapsulate Collection</h4><h5 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Usually add “Add” and “Remove” functions for accessing the collection</li>
<li>Create a function that returns the copy of the collection. This avoids changing the original collection</li>
<li>If we want set the collection, use the copy of parameter collection to set.</li>
</ul>
<h5 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Encapsulation</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Encapsulate%20Collection">Github</a></p>
<h4 id="Replace-Primitive-with-Object"><a href="#Replace-Primitive-with-Object" class="headerlink" title="Replace Primitive with Object"></a>Replace Primitive with Object</h4><h5 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Some simple number&#x2F;string instances will has complex logic, we should encapsulate them into classes. These classes are <strong>value classes.</strong></li>
<li>Consider <strong><em>Change Reference to Value</em></strong> or <strong><em>Change Value to Reference</em></strong> for the created object.</li>
</ul>
<h5 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Replacement</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Replace%20Primitive%20with%20Object">Github</a></p>
<h4 id="Replace-Temp-with-Query"><a href="#Replace-Temp-with-Query" class="headerlink" title="Replace Temp with Query"></a>Replace Temp with Query</h4><h5 id="Tips-3"><a href="#Tips-3" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>This skill is used for the temp variable that is calculated once.</li>
<li>Some temp variable is calculated many times, we also extract its calculation logic into query function.</li>
</ul>
<h5 id="Examples-3"><a href="#Examples-3" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Replacement</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Replace%20Temp%20with%20Query">Github</a></p>
<h4 id="Extract-Class"><a href="#Extract-Class" class="headerlink" title="Extract Class"></a>Extract Class</h4><h5 id="Tips-4"><a href="#Tips-4" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If one class’s responsibility is too huge, we consider that the class is split into main class and sub class. Sub class has the closed activities of functions&#x2F;data.</li>
</ul>
<h5 id="Examples-4"><a href="#Examples-4" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Extraction</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Extract%20Class">Github</a></p>
<h4 id="Inline-Class"><a href="#Inline-Class" class="headerlink" title="Inline Class"></a>Inline Class</h4><h5 id="Tips-5"><a href="#Tips-5" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If one class’s responsibility has no reason to exist by its single class, move this class’s member into another class.</li>
</ul>
<h5 id="Examples-5"><a href="#Examples-5" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Inline</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Inline%20Class">Github</a></p>
<h4 id="Hide-Delegate"><a href="#Hide-Delegate" class="headerlink" title="Hide Delegate"></a>Hide Delegate</h4><h5 id="Tips-6"><a href="#Tips-6" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Create the delegate function to hide the inner relationship between the called object and the caller. If the called object changes, the caller still uses the delegate function without knowing the change.</li>
</ul>
<h5 id="Examples-6"><a href="#Examples-6" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple Hiding</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch7.Encapsulation/Hide%20Delegate">Github</a></p>
<h4 id="Remove-Middle-Man"><a href="#Remove-Middle-Man" class="headerlink" title="Remove Middle Man"></a>Remove Middle Man</h4><h5 id="Tips-7"><a href="#Tips-7" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If the delegate functions are too many, adjust caller to directly call the target object.</li>
</ul>
<h5 id="Examples-7"><a href="#Examples-7" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Just use the <strong>Hide Delegate</strong> example from end to start</li>
</ul>
<h4 id="Substitute-Algorithm"><a href="#Substitute-Algorithm" class="headerlink" title="Substitute Algorithm"></a>Substitute Algorithm</h4><h5 id="Tips-8"><a href="#Tips-8" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If the new algorithm is easy to maintain, we consider that the old algorithm is replaced by the new one.</li>
</ul>
<h5 id="Examples-8"><a href="#Examples-8" class="headerlink" title="Examples:"></a>Examples:</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">string</span> <span class="title">FindPerson</span>(<span class="params"><span class="built_in">string</span>[] people</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; people.Length; i++) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (people[i] == <span class="string">&quot;Don&quot;</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Don&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (people[i] == <span class="string">&quot;John&quot;</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;John&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (people[i] == <span class="string">&quot;Kent&quot;</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Kent&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">string</span> <span class="title">FindPerson</span>(<span class="params"><span class="built_in">string</span>[] people</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">string</span>[] candidates = <span class="keyword">new</span> <span class="built_in">string</span>[]&#123;<span class="string">&quot;Don&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Kent&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">return</span> people.FirstOrDefault(x =&gt; candidates.Contains(x)) ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>This chapter introduces me to the concept of complete encapsulation! If you want to learn detailed motivation and mechanics, study the chapter 7 “ Encapsulation “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. and it improves our programmer’s ability.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/30/refactoring-chapter-6-a-first-set-of-refactorings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/30/refactoring-chapter-6-a-first-set-of-refactorings/" class="post-title-link" itemprop="url">A First Set of Refactorings</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-30 18:51:21" itemprop="dateCreated datePublished" datetime="2022-01-30T18:51:21+08:00">2022-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This article references the chapter 6 “ A First Set of Refactorings “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. Author had highlighted many important refactorings in this chapter.</p>
<p>I use .NET C# to practice with these refactorings and upload to Github.</p>
<p><a target="_blank" rel="noopener" href="https://geekcodeparadise.com/wp-content/uploads/2022/01/plumber-4427401_1920-1024x620.jpg"><img src="https://geekcodeparadise.com/wp-content/uploads/2022/01/plumber-4427401_1920-1024x620.jpg" alt="A first set of refactorings"></a></p>
<p>(Photo from Pixabay: <a target="_blank" rel="noopener" href="https://pixabay.com/illustrations/plumber-repair-tools-pipe-plunger-4427401/">https://pixabay.com/illustrations/plumber-repair-tools-pipe-plunger-4427401/ )</a></p>
<h4 id="Extract-Function"><a href="#Extract-Function" class="headerlink" title="Extract Function"></a>Extract Function</h4><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Redundant logics should be extracted as a function</li>
<li>A function is best when developers see its naming and understand what it does without looking at its implementation.</li>
<li>A function usually has few lines of code.</li>
<li>Sometimes a extracted function is not proper, then transfer it into inline lines.</li>
</ul>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>No Variables Out of Scope</li>
<li>Using Local Variables</li>
<li>Reassigning a Local Variable</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Extract%20Function">Github</a></p>
<h4 id="Inline-Function"><a href="#Inline-Function" class="headerlink" title="Inline Function"></a>Inline Function</h4><h5 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If the indirect call of this function is not required, make it as inline function</li>
<li>This function has no polymorphism. It means that if this function belongs to a class and subclass uses it, inline function doesn’t work.</li>
</ul>
<h5 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Rating</li>
<li>Report Lines</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Inline%20Function">Github</a></p>
<h4 id="Extract-Variable"><a href="#Extract-Variable" class="headerlink" title="Extract Variable"></a>Extract Variable</h4><h5 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Some expressions are complex, so use Extract Variable to improve readability.</li>
<li>Check the target expression has no side-effect before extract it</li>
</ul>
<h5 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Static Function</li>
<li>In a Class</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Extract%20Variable">Github</a></p>
<h4 id="Inline-Variable"><a href="#Inline-Variable" class="headerlink" title="Inline Variable"></a>Inline Variable</h4><h5 id="Tips-3"><a href="#Tips-3" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If this variable hinders the nearby refactoring, this variable should be removed.</li>
<li>Check the right side of the assignment to the variable has no side-effect.</li>
</ul>
<h5 id="Examples-3"><a href="#Examples-3" class="headerlink" title="Examples:"></a>Examples:</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> grade = student.Grade;</span><br><span class="line"><span class="keyword">return</span> (grade &gt;= <span class="number">60</span>);</span><br><span class="line"><span class="comment">// after Inline Variable</span></span><br><span class="line"><span class="keyword">return</span> student.Grade &gt;= <span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Change-Function-Declaration"><a href="#Change-Function-Declaration" class="headerlink" title="Change Function Declaration"></a>Change Function Declaration</h4><h5 id="Tips-4"><a href="#Tips-4" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>A good function name increases readability.</li>
<li>Changing parameters of a function decouple between the modules.</li>
<li>If an published API should be refactored, then use [deprecated] for the original function. After a period, migrate the old function to the new one and remove the old one.</li>
</ul>
<h5 id="Examples-4"><a href="#Examples-4" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Renaming a Function (Simple Mechanics)</li>
<li>Renaming a Function (Migration Mechanics)</li>
<li>Adding a Paramete</li>
<li>Changing a Parameter to One of Its Properties</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Change%20Function%20Declaration">Github</a></p>
<h4 id="Encapsulate-Variable"><a href="#Encapsulate-Variable" class="headerlink" title="Encapsulate Variable"></a>Encapsulate Variable</h4><h5 id="Tips-5"><a href="#Tips-5" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Usually use function to encapsulate access of variables</li>
<li>For mutable data, if its scope exceeds one function, we encapsulate it.</li>
<li>If the variable’s value is a record, we can use <strong><em>Encapsulate Record</em></strong></li>
</ul>
<h5 id="Examples-5"><a href="#Examples-5" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Simple</li>
<li>Encapsulating the Value</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Encapsulate%20Variable">Github</a></p>
<h4 id="Rename-Variable"><a href="#Rename-Variable" class="headerlink" title="Rename Variable"></a>Rename Variable</h4><h5 id="Tips-6"><a href="#Tips-6" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Good naming increases readability</li>
<li>If the variable is widely used, we can use <strong><em>Encapsulate Variable</em></strong></li>
<li>If this variable is a published variable, we can’t use this refactoring</li>
</ul>
<h5 id="Examples-6"><a href="#Examples-6" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Encapsulating Variable</li>
<li>Renaming a Constant</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Rename%20Variable">Github</a></p>
<h4 id="Introduce-Parameter-Object"><a href="#Introduce-Parameter-Object" class="headerlink" title="Introduce Parameter Object"></a>Introduce Parameter Object</h4><h5 id="Tips-7"><a href="#Tips-7" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Use a class to packs the parameters of a function</li>
<li>Keep these classes as Value Objects (DDD)</li>
<li>Use <strong><em>Change Function Declaration</em></strong> to create the new class parameter</li>
</ul>
<h5 id="Examples-7"><a href="#Examples-7" class="headerlink" title="Examples:"></a>Examples:</h5><ul>
<li>Change Function Declaration</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Introduce%20Parameter%20Object">Github</a></p>
<h4 id="Combine-Functions-into-Class"><a href="#Combine-Functions-into-Class" class="headerlink" title="Combine Functions into Class"></a>Combine Functions into Class</h4><h5 id="Tips-8"><a href="#Tips-8" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some parameter exists in multiple functions, creating a class is a good choice. Move the parameter to class field and reduce parameter of function.</li>
<li><strong><em>Combine Functions into Transform</em></strong> is another choice depending on the context</li>
<li>Use <strong><em>Encapsulate Record</em></strong> for the previously mentioned parameters. Then use <strong><em>Move Function</em></strong> for those function into a new class.</li>
<li>We can use <strong><em>Extract Function</em></strong> for the logic processing the record data into the new class.</li>
</ul>
<h5 id="Examples-8"><a href="#Examples-8" class="headerlink" title="Examples:"></a>Examples:</h5><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Combine%20Functions%20into%20Class">Github</a></p>
<h4 id="Combine-Functions-into-Transform"><a href="#Combine-Functions-into-Transform" class="headerlink" title="Combine Functions into Transform"></a>Combine Functions into Transform</h4><h5 id="Tips-9"><a href="#Tips-9" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>Transform function loads the original data, then use some functions to get new data and set it the fields of <strong>derivation</strong> data.</li>
<li>Comparing with <strong><em>Combine Functions into Class,</em></strong> if some code logic updates the original data, <strong><em>Combine Functions into Class</em></strong> is better.</li>
<li>In a transform function, first <strong>deep copy</strong> the loaded original data into result(derivation) data. Finally return this result data.</li>
<li>If the structure of the result is the same as the original, the transform function uses “Enrich” as prefix naming. If the structure changes, then use “Transform” as prefix naming.</li>
<li>It’s not recommended for JavaScript to use this refactoring instead of using <strong><em>Combine Functions into Class</em></strong> because of <strong>Immutable data</strong></li>
</ul>
<h5 id="Examples-9"><a href="#Examples-9" class="headerlink" title="Examples:"></a>Examples:</h5><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Combine%20Functions%20into%20Transform">Github</a></p>
<h4 id="Split-Phase"><a href="#Split-Phase" class="headerlink" title="Split Phase"></a>Split Phase</h4><h5 id="Tips-10"><a href="#Tips-10" class="headerlink" title="Tips"></a>Tips</h5><ul>
<li>If some logic concurrently processes 2 different things, then separate it into 2 independent modules.</li>
<li>Extract the second phase code as a new function. And create an intermediate data structure as the parameter of the new function.</li>
<li>If some parameters in second phase are used by first phase, then move these parameters into the intermediate data structure.</li>
<li>Extract the first phase as a function and this function returns the intermediate data structure.</li>
</ul>
<h5 id="Examples-10"><a href="#Examples-10" class="headerlink" title="Examples:"></a>Examples:</h5><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd/tree/master/Ch6.A%20First%20Set%20of%20Refactorings/Split%20Phase">Github</a></p>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>This chapter introduces me to a whole clever coding environment! I think I ever did some similar refactorings in my previous projects without so detailed guidelines. If you want to learn detailed motivation and mechanics, study the chapter 6 “ A First Set of Refactorings “ of <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. and it improves our programmer’s ability.</p>
<p>A First Set of Refactorings</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/09/refactoring-2nd-chapter-1-example/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/09/refactoring-2nd-chapter-1-example/" class="post-title-link" itemprop="url">Refactoring Example - RPG Game Hunting Mission</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-09 23:11:21" itemprop="dateCreated datePublished" datetime="2022-01-09T23:11:21+08:00">2022-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:26" itemprop="dateModified" datetime="2023-11-19T15:47:26+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Refactoring/" itemprop="url" rel="index"><span itemprop="name">Refactoring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Welcome-to-Refactoring-World"><a href="#Welcome-to-Refactoring-World" class="headerlink" title="Welcome to Refactoring World!"></a>Welcome to Refactoring World!</h1><h4 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h4><p>I will write a series of refactoring article based on Martin Fowler’s <a target="_blank" rel="noopener" href="https://amzn.to/3LUmBwI">Refactoring: Improving the Design of Existing Code (2nd Edition)</a>. This book introduced many useful refactoring techniques. So I want to share what I learned from this book by explaining some refactoring examples and noting important concepts&#x2F;tips. The first one refactoring example in this article!</p>
<p>In the chapter 1 of the book, it introduced a case about the bill calculation of performing theatrical plays. The case first was an ugly function code to generate a bill. After some refactoring skills, the code looked CLEAR. How beautiful the code is!</p>
<p>According to this case, I will mock a similar function code to show how the refactoring skill works in this example. The following code is written by C# &amp; .NET 5.</p>
<h4 id="2-RPG-Game-Hunting-Mission"><a href="#2-RPG-Game-Hunting-Mission" class="headerlink" title="2. RPG Game Hunting Mission"></a>2. RPG Game Hunting Mission</h4><p>This scenario is a RPG Game. In a RPG Game, a player can take hunting mission to earn bonus and experience. If player completes the mission, then mission manager will give you the bonus&#x2F;experience. The type and level of monster killed by player determines the amount of bonus and experience.</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/07/122222.jpg" alt="refactoring example rpg game"></p>
<p>Bless Unleashed (Picture Source: <a target="_blank" rel="noopener" href="https://draft.blogger.com/blog/post/edit/760085690055515370/8483927943229049666?hl=zh-TW#">https://www.mmorpg.com/news/bless-unleashed-gm-battlefield-event-for-june-19-2000122222</a>)</p>
<h5 id="2-1-Monsters-and-Mission"><a href="#2-1-Monsters-and-Mission" class="headerlink" title="2.1 Monsters and Mission"></a>2.1 Monsters and Mission</h5><p>Mission manager have a monster list that shows the id, name and type. As the following Figure 1 shows:</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/07/ch1_monsters.png"></p>
<p>Figure 1. Monster List (Monster picture source: <a target="_blank" rel="noopener" href="https://draft.blogger.com/blog/post/edit/760085690055515370/8483927943229049666?hl=zh-TW#">https://opengameart.org/content/dungeon-crawl-selected-upscale</a>)</p>
<p>One hunting mission includes these monsters as the following Figure 2 shows:</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/07/ch1_mission.png"></p>
<p>Figure 2. Mission Detail</p>
<p>I create some classes representing the structure of these monster list and mission.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HuntingMission</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;HuntingTarget&gt; Targets &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingMission</span>(<span class="params"><span class="built_in">string</span> name, List&lt;HuntingTarget&gt; targets</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Name = name;</span><br><span class="line">Targets = targets;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HuntingTarget</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MonsterId &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Level &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingTarget</span>(<span class="params"><span class="built_in">string</span> monsterId, <span class="built_in">int</span> level</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">MonsterId = monsterId;</span><br><span class="line">Level = level;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monster</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Monster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">string</span> type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Name = name;</span><br><span class="line">Type = type;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then create instances representing the above monster list and mission:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Monster&gt;();</span><br><span class="line">monsters.Add(<span class="string">&quot;fire_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Fire Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;stone_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Stone Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;bone_dragon&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Bone Dragon&quot;</span>, <span class="string">&quot;dragon&quot;</span>));</span><br><span class="line">HuntingMission mission = <span class="keyword">new</span> HuntingMission(<span class="string">&quot;Giant &amp; Dragon Hunting&quot;</span>, <span class="keyword">new</span> List&lt;HuntingTarget&gt;(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;fire_giant&quot;</span>, <span class="number">55</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;bone_dragon&quot;</span>, <span class="number">40</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;stone_giant&quot;</span>, <span class="number">61</span>)</span><br><span class="line">&#125;));</span><br><span class="line">List&lt;HuntingMission&gt; missions = <span class="keyword">new</span> List&lt;HuntingMission&gt;(<span class="keyword">new</span>[] &#123; mission &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="2-2-First-version-of-Calculation-of-Bonus-Experience"><a href="#2-2-First-version-of-Calculation-of-Bonus-Experience" class="headerlink" title="2.2 First version of Calculation of Bonus&#x2F;Experience"></a>2.2 First version of Calculation of Bonus&#x2F;Experience</h5><p>Create a mission manager class and a function Statement. Pass the monster list and mission to this Statement function and it returns a calculated bonus&#x2F;experience string.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> monster = monsters[missionTarget.MonsterId];</span><br><span class="line"><span class="built_in">int</span> thisBonus = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">thisBonus = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">thisBonus += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">thisBonus = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">thisBonus += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">thisBonus += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monster.Name&#125;</span>: <span class="subst">&#123;(thisBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += thisBonus;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-The-Problem-of-This-Function"><a href="#2-3-The-Problem-of-This-Function" class="headerlink" title="2.3 The Problem of This Function"></a>2.3 The Problem of This Function</h5><ol>
<li>It’s not clear</li>
<li>If the returned string need HTML format, adding this feature to this code is not maintainable.</li>
<li>If the type of monster is increased, adding this feature is also hard.</li>
</ol>
<p>The tip at book’s page 4 describes:</p>
<blockquote>
<p><em><strong>When you have to add a feature to a program but the code is not structured in a convenient way, first refactor the program to make it easy to add the feature, then add the feature.</strong></em></p>
</blockquote>
<p>As this tip’s guide, let’s refactor the code!</p>
<h5 id="2-4-The-First-Step-in-Refactoring"><a href="#2-4-The-First-Step-in-Refactoring" class="headerlink" title="2.4 The First Step in Refactoring"></a>2.4 The First Step in Refactoring</h5><p>The tip at book’s page 5 describes:</p>
<blockquote>
<p><strong><em>Before you start refactoring, make sure you have a solid suite of tests. These tests must be self-checking.</em></strong></p>
</blockquote>
<p>I have created a unit testing project to check current’s function is correct.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MIssionManagerTests</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Given_Mission_Monsters_Should_Return_Correct_Statement</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// arrange</span></span><br><span class="line">Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Monster&gt;();</span><br><span class="line">monsters.Add(<span class="string">&quot;fire_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Fire Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;stone_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Stone Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;bone_dragon&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Bone Dragon&quot;</span>, <span class="string">&quot;dragon&quot;</span>));</span><br><span class="line">HuntingMission mission = <span class="keyword">new</span> HuntingMission(<span class="string">&quot;Giant &amp; Dragon Hunting&quot;</span>, <span class="keyword">new</span> List&lt;HuntingTarget&gt;(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;fire_giant&quot;</span>, <span class="number">55</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;bone_dragon&quot;</span>, <span class="number">40</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;stone_giant&quot;</span>, <span class="number">61</span>)</span><br><span class="line">&#125;));</span><br><span class="line">List&lt;HuntingMission&gt; missions = <span class="keyword">new</span> List&lt;HuntingMission&gt;(<span class="keyword">new</span>[] &#123; mission &#125;);</span><br><span class="line"><span class="comment">// act</span></span><br><span class="line"><span class="built_in">string</span> result = <span class="keyword">new</span> MissionManager().Statement(missions.First(), monsters);</span><br><span class="line"><span class="comment">// assert</span></span><br><span class="line">Assert.AreEqual(</span><br><span class="line"><span class="string">&quot;Statement for Giant &amp; Dragon Hunting\nFire Giant: $750.00 (55 levels)\nBone Dragon: $950.00 (40 levels)\nStone Giant: $780.00 (61 levels)\nBonus was $2,480.00\nYou got 49 experiences\n&quot;</span>, </span><br><span class="line">result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After call the Statement function with the above monster list and mission, the returned string is:</p>
<p>Statement for Giant &amp; Dragon Hunting<br>Fire Giant: $750.00 (55 levels)<br>Bone Dragon: $950.00 (40 levels)<br>Stone Giant: $780.00 (61 levels)<br>Bonus was $2,480.00<br>You got 49 experiences  </p>
<p>So the assertion is used to check the returned result is equal to the above string.I will change some code and use the unit testing to check again that my code keeps original solution. Testings are very important!</p>
<h5 id="2-5-Decomposing-the-Statement-Function"><a href="#2-5-Decomposing-the-Statement-Function" class="headerlink" title="2.5 Decomposing the Statement Function"></a>2.5 Decomposing the Statement Function</h5><p>The middle of the code has a <strong>switch</strong> statement that calculates the current bonus amount based on monster type. Let’s do the <em>Extract Function</em>: the switch statement is extracted to an amountFor  delegate function:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget, Monster monster)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> thisBonus = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">thisBonus = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">thisBonus += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">thisBonus = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">thisBonus += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">thisBonus += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> thisBonus;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> monster = monsters[missionTarget.MonsterId];</span><br><span class="line"><span class="built_in">int</span> thisBonus = amountFor(missionTarget, monster);</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monster.Name&#125;</span>: <span class="subst">&#123;(thisBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += thisBonus;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This amountFor delegate function is simulating the code block like book’s JavaScript logic. If you are using C# 7.0 or higher version, it can be converted into <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/local-functions">local function</a>.</p>
<p>After run the unit testing, this code keeps original solution. The missionTarget and monster parameters are not modified in switch statement, so they can be passed to a function. </p>
<p>The tip at book’s page 8 describes:</p>
<blockquote>
<p><em><strong>Refactoring changes the programs in small steps, so if you make a mistake, it is easy to find where the bug is.</strong></em></p>
</blockquote>
<p>In the amountFor delegate function, the <em>thisBonus</em> variable naming is not clear, so <em>change</em> it to result naming:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;HuntingTarget, Monster, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget, Monster monster)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>The <em>result</em> naming represents its responsibility and increases readability.</p>
<p>The tip at book’s page 10 describes:</p>
<blockquote>
<p>Any fool can write code that a computer can understand. Good programmers write code that humans can understand.</p>
</blockquote>
<p>What a ABSOLUTE TRUE!</p>
<h6 id="2-5-1-Removing-the-monster-Variable"><a href="#2-5-1-Removing-the-monster-Variable" class="headerlink" title="2.5.1 Removing the monster Variable"></a>2.5.1 Removing the monster Variable</h6><p>Let’s check the amountFor function, missionTarget variable is set a new value by every for loop, but monster variable is calculated by missionTarget. So monster variable is not required to be passed as a parameter.<br>Use a refactoring method <em>Replace Temp with Query</em>: extracting the right-hand site of the assignment into a function.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span>(HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, Monster, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget, Monster monster)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> monster = monsterFor(missionTarget);</span><br><span class="line"><span class="built_in">int</span> thisBonus = amountFor(missionTarget, monster);</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monster.Name&#125;</span>: <span class="subst">&#123;(thisBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += thisBonus;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then use <em>Inline Variable.</em></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span>(HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, Monster, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget, Monster monster)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> thisBonus = amountFor(missionTarget, monsterFor(missionTarget));</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;(thisBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += thisBonus;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then use <em>Change Function Declaration</em> to amountFor to remove the monster variable_._ There are 2 steps, in first step I change it to use monsterFor:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;HuntingTarget, Monster, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget, Monster monster)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. In second step I remove the monster parameter of amountFor function:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span>(HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> thisBonus = amountFor(missionTarget);</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;(thisBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += thisBonus;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. I feel concerned that monsterFor is called 4 times and is more than the first version (called 1 time). It seems a bit performance problem but it’s not a serious situation. Martin said he will discuss in later chapters.</p>
<p>Let’s use <em>Inline Variable</em> again_._ thisBonus variable is assigned and not modified so use amountFor to replace it:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span>(HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">totalExperience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;(amountFor(missionTarget) / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works.</p>
<h6 id="2-5-2-Extracting-Total-Experience"><a href="#2-5-2-Extracting-Total-Experience" class="headerlink" title="2.5.2 Extracting Total Experience"></a>2.5.2 Extracting Total Experience</h6><p>totalExperience is updated in the for loop. Let’s extract the a function that calculates the new experience value and returns it to totalExperience:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> experience = <span class="number">0</span>;</span><br><span class="line">experience += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">experience += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> experience;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;(amountFor(missionTarget) / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;(totalBonus / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. I also rename the experience variable to result:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works.</p>
<h6 id="2-5-3-Removing-the-localFormat-variable"><a href="#2-5-3-Removing-the-localFormat-variable" class="headerlink" title="2.5.3 Removing the localFormat variable"></a>2.5.3 Removing the localFormat variable</h6><p>Temporary variables are underlying problems. It’s suggested to transfer them into functions. Let’s create a declared function to replace localFormat:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; format = <span class="built_in">delegate</span>(<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">return</span> aNumber.ToString(<span class="string">&quot;c&quot;</span>, localFormat);</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;format(amountFor(missionTarget) / <span class="number">100</span>)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;format(totalBonus / <span class="number">100</span>)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. The function naming format is not clear that doesn’t explain its responsibility. Let’s use <em>Change Function Declaration</em> skill:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span>(<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">return</span> (aNumber / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat);</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Good function naming means that you can read the functionality without reading its underlying inner struct. Naming talks you what they do.</p>
<h6 id="2-5-4-Removing-the-totalExperience-variable"><a href="#2-5-4-Removing-the-totalExperience-variable" class="headerlink" title="2.5.4 Removing the totalExperience variable"></a>2.5.4 Removing the totalExperience variable</h6><p>This totalExperience variable is accumulated in a for loop. Let’s use <strong><em>Split Loop</em></strong> to separate it: </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then use <strong>Slide Statements</strong> to put the declaration of the variable close to the loop:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then use <em><strong>Extract Function</strong></em> to the totalExperience variable:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span>(<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">return</span> (aNumber / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat);</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> totalExperience;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> totalExperience = totalExperiences();</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperience&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next is <em>Inline Variable</em> to the totalExperience variable:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. </p>
<p>For totalBonus variable, I refactor it with the same refactoring skill done with totalExperience variable. First I use <em><strong>Extract Function</strong></em> to the totalBonus variable:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (monsterFor(missionTarget).Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span>(<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">return</span> (aNumber / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat);</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalExperience = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">totalExperience += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> totalExperience;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (monsterFor(missionTarget).Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monsterFor(missionTarget).Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> totalBonus = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">totalBonus += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> totalBonus;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> totalBonus = totalBonuses();</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonus)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next is <em>Inline Variable</em> to the totalBonus variable:</p>
<p>public string Statement(HuntingMission mission, Dictionary&lt;string, Monster&gt; monsters)<br>{<br>string result &#x3D; $”Statement for {mission.Name}\n”;<br>foreach (var missionTarget in mission.Targets)<br>{<br>result +&#x3D;<br>$”{monsterFor(missionTarget).Name}: {usd(amountFor(missionTarget))} ({missionTarget.Level} levels)\n”;<br>}</p>
<p>result +&#x3D; $”Bonus was {usd(totalBonuses())}\n”;<br>result +&#x3D; $”You got {totalExperiences()} experiences\n”;</p>
<p>return result;<br>}</p>
<p>After compilation and testing, this refactoring example works. </p>
<p>Let’s rename the calculated variables to result:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">result += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-6-Splitting-the-Phases-of-Calculation-and-Formatting"><a href="#2-6-Splitting-the-Phases-of-Calculation-and-Formatting" class="headerlink" title="2.6 Splitting the Phases of Calculation and Formatting"></a>2.6 Splitting the Phases of Calculation and Formatting</h4><p>The above Statement function can return the bonus&#x2F;experience by the monster list and the hunting mission. But the bonus&#x2F;experience format is a kind of version. If the format is extended into HTML version, how should I refactor it?Let’s use <strong><em>Split Phase</em></strong> to split the function into the logic of two phases: calculating the data structure of bonus&#x2F;experience and rendering the format(pure string or HTML) by the data structure.<em><strong>Extract Function</strong></em> is applied to the second phase that is rendering the format. The whole Statement’s content is transferred into another function RenderPlainText:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(mission, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then create a object that is transferred between the two phases:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, mission, monsters);&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;mission.Name&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementData</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Current SatatementData class has no any property. After compilation and testing, this refactoring example works.<br>Make RenderPlainText to use required parameter in StatementData instance. First step move mission name to this statementData:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, mission, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//all delegate functions are hidden</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> mission.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementData</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MissionName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then also move Targets to statementData and delete the mission variable:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets;</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, mission, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">result += experienceFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result += amountFor(missionTarget);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;monsterFor(missionTarget).Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementData</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MissionName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;HuntingTarget&gt; Targets &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. The StatementData’s Targets variable then is set as an immutable data by enrichTarget delegate function:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, HuntingTarget&gt; enrichTarget = <span class="built_in">delegate</span>(HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">HuntingTarget result = target;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, monsters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use <em><strong>Move Function</strong></em> skill to Statement and monsterFor functions, then all original references to monsterFor are replaced with data instance. Before I move them, I create another class <strong>CalculatedTarget.</strong> Its properties are the same as the class HuntingTarget and it has extra property Monster. CalculatedTarget’s instances are replaced with HuntingMission’s Targets. Then RenderPlainText’s referenced delegate functions are updated to use CalculatedTarget:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span>(HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = monsterFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (missionTarget.Monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (missionTarget.Monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;missionTarget.Monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;missionTarget.Monster.Name&#125;</span>: <span class="subst">&#123;usd(amountFor(missionTarget))&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementData</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MissionName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;CalculatedTarget&gt; Targets &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">CalculatedTarget</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MonsterId &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Level &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CalculatedTarget</span>(<span class="params"><span class="built_in">string</span> monsterId, <span class="built_in">int</span> level</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">MonsterId = monsterId;</span><br><span class="line">Level = level;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then use the same <em><strong>Move Function</strong></em> skill to Statement and amountFor functions:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (missionTarget.Monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (missionTarget.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (missionTarget.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (missionTarget.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * missionTarget.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;missionTarget.Monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span>(HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = monsterFor(result);</span><br><span class="line">result.Amount = amountFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Amount;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;missionTarget.Monster.Name&#125;</span>: <span class="subst">&#123;usd(missionTarget.Amount)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">CalculatedTarget</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MonsterId &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Level &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Amount &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CalculatedTarget</span>(<span class="params"><span class="built_in">string</span> monsterId, <span class="built_in">int</span> level</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">MonsterId = monsterId;</span><br><span class="line">Level = level;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then use the same <em><strong>Move Function</strong></em> skill to Statement and experienceFor functions:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(missionTarget.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (missionTarget.Monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span>(HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = monsterFor(result);</span><br><span class="line">result.Amount = amountFor(result);</span><br><span class="line">result.Experience = experienceFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">result += missionTarget.Experience;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;<span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> ()</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;missionTarget.Monster.Name&#125;</span>: <span class="subst">&#123;usd(missionTarget.Amount)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(totalBonuses())&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;totalExperiences()&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">CalculatedTarget</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MonsterId &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Level &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Amount &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Experience &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CalculatedTarget</span>(<span class="params"><span class="built_in">string</span> monsterId, <span class="built_in">int</span> level</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">MonsterId = monsterId;</span><br><span class="line">Level = level;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Finally,  use <em><strong>Move Function</strong></em> skill to Statement, totalExperiences and totalBonuses functions:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span>(HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// add experience</span></span><br><span class="line">result += missionTarget.Experience;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result += missionTarget.Amount;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(statementData, monsters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; usd = <span class="built_in">delegate</span> (<span class="built_in">int</span> aNumber)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;Statement for <span class="subst">&#123;data.MissionName&#125;</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;<span class="subst">&#123;missionTarget.Monster.Name&#125;</span>: <span class="subst">&#123;usd(missionTarget.Amount)&#125;</span> (<span class="subst">&#123;missionTarget.Level&#125;</span> levels)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;Bonus was <span class="subst">&#123;usd(data.TotalBonuses)&#125;</span>\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;You got <span class="subst">&#123;data.TotalExperiences&#125;</span> experiences\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementData</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MissionName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;CalculatedTarget&gt; Targets &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> TotalBonuses &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> TotalExperiences &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Some functions are refactored with Replace Loop with Pipeline:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> data.Targets.Sum(x =&gt; x.Experience);</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> data.Targets.Sum(x =&gt; x.Amount);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Extract the code into a independent function in the first phase (Statement Function) and  remove the monsters argument of RenderPlainText function:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(CreateStatementData(mission, monsters));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. Then extract this CreateStatementData function into another class StatementDataManager: </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> RenderPlainText(<span class="keyword">new</span> StatementDataManager().CreateStatementData(mission, monsters));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementDataManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works. It’s easy to create a rendering HTML format function and create a new unit testing function to test it. For usd function, it’s transferred to top function because of common use:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MissionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Statement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">HtmlStatement</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> RenderHtml(<span class="keyword">new</span> StatementDataManager().CreateStatementData(mission, monsters));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderHtml</span>(<span class="params">StatementData data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">string</span> result = <span class="string">$&quot;&lt;h1&gt;Statement for <span class="subst">&#123;data.MissionName&#125;</span>&lt;/h1&gt;\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;&lt;table&gt;\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;&lt;tr&gt;&lt;th&gt;Monster Name&lt;/th&gt;&lt;th&gt;Bonus&lt;/th&gt;&lt;th&gt;Level&lt;/th&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> missionTarget <span class="keyword">in</span> data.Targets)</span><br><span class="line">&#123;</span><br><span class="line">result +=</span><br><span class="line"><span class="string">$&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;missionTarget.Monster.Name&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;Usd(missionTarget.Amount)&#125;</span>&lt;/td&gt;&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;&lt;td&gt;<span class="subst">&#123;missionTarget.Level&#125;</span>&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="string">$&quot;&lt;/table&gt;\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;&lt;p&gt;Bonus was &lt;em&gt;<span class="subst">&#123;Usd(data.TotalBonuses)&#125;</span>&lt;/em&gt;&lt;/p&gt;\n&quot;</span>;</span><br><span class="line">result += <span class="string">$&quot;&lt;p&gt;You got &lt;em&gt;<span class="subst">&#123;data.TotalExperiences&#125;</span>&lt;/em&gt; experiences&lt;/p&gt;\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">RenderPlainText</span>(<span class="params">StatementData data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">Usd</span>(<span class="params"><span class="built_in">int</span> aNumber</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">CultureInfo enCulture = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;en-US&quot;</span>);</span><br><span class="line">Thread.CurrentThread.CurrentCulture = enCulture;</span><br><span class="line">NumberFormatInfo localFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();</span><br><span class="line"><span class="keyword">return</span> (aNumber / <span class="number">100</span>).ToString(<span class="string">&quot;c&quot;</span>, localFormat);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MIssionManagerTests</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Given_Mission_Monsters_Should_Return_Correct_Statement</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Given_Mission_Monsters_Should_Return_Correct_HtmlStatement</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// arrange</span></span><br><span class="line">Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Monster&gt;();</span><br><span class="line">monsters.Add(<span class="string">&quot;fire_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Fire Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;stone_giant&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Stone Giant&quot;</span>, <span class="string">&quot;giant&quot;</span>));</span><br><span class="line">monsters.Add(<span class="string">&quot;bone_dragon&quot;</span>, <span class="keyword">new</span> Monster(<span class="string">&quot;Bone Dragon&quot;</span>, <span class="string">&quot;dragon&quot;</span>));</span><br><span class="line">HuntingMission mission = <span class="keyword">new</span> HuntingMission(<span class="string">&quot;Giant &amp; Dragon Hunting&quot;</span>, <span class="keyword">new</span> List&lt;HuntingTarget&gt;(<span class="keyword">new</span>[]</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;fire_giant&quot;</span>, <span class="number">55</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;bone_dragon&quot;</span>, <span class="number">40</span>),</span><br><span class="line"><span class="keyword">new</span> HuntingTarget(<span class="string">&quot;stone_giant&quot;</span>, <span class="number">61</span>)</span><br><span class="line">&#125;));</span><br><span class="line">List&lt;HuntingMission&gt; missions = <span class="keyword">new</span> List&lt;HuntingMission&gt;(<span class="keyword">new</span>[] &#123; mission &#125;);</span><br><span class="line"><span class="comment">// act</span></span><br><span class="line"><span class="built_in">string</span> result = <span class="keyword">new</span> MissionManager().HtmlStatement(missions.First(), monsters);</span><br><span class="line"><span class="comment">// assert</span></span><br><span class="line">Assert.AreEqual(</span><br><span class="line"><span class="string">&quot;&lt;h1&gt;Statement for Giant &amp; Dragon Hunting&lt;/h1&gt;\n&lt;table&gt;\n&lt;tr&gt;&lt;th&gt;Monster Name&lt;/th&gt;&lt;th&gt;Bonus&lt;/th&gt;&lt;th&gt;Level&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Fire Giant&lt;/td&gt;&lt;td&gt;$750.00&lt;/td&gt;&lt;td&gt;55&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Bone Dragon&lt;/td&gt;&lt;td&gt;$950.00&lt;/td&gt;&lt;td&gt;40&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Stone Giant&lt;/td&gt;&lt;td&gt;$780.00&lt;/td&gt;&lt;td&gt;61&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&lt;p&gt;Bonus was &lt;em&gt;$2,480.00&lt;/em&gt;&lt;/p&gt;\n&lt;p&gt;You got &lt;em&gt;49&lt;/em&gt; experiences&lt;/p&gt;\n&quot;</span>,</span><br><span class="line">result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring example works.</p>
<h5 id="2-7-Status-Separated-into-Two-Files-and-Phases"><a href="#2-7-Status-Separated-into-Two-Files-and-Phases" class="headerlink" title="2.7 Status: Separated into Two Files (and Phases)"></a>2.7 Status: Separated into Two Files (and Phases)</h5><p>Current files are separated into MissionManager and StatementDataManager 2 files. Although these code lines has increased, refactoring makes the code more readability. This separation of logic (calculation &amp; rendering) enhances the modular design and no redundant calculation logic.</p>
<p>The tip at book’s page 34 describes:</p>
<blockquote>
<p>When programming, follow the camping rule: Always leave the code base healthier than when you found it.</p>
</blockquote>
<p>Make the code healthier again!</p>
<h5 id="2-8-Reorganizing-the-Calculations-by-Type"><a href="#2-8-Reorganizing-the-Calculations-by-Type" class="headerlink" title="2.8 Reorganizing the Calculations by Type"></a>2.8 Reorganizing the Calculations by Type</h5><p>In this example, amountFor and experienceFor functions determines their result based on the monster type. Current type has dragon and giant. But in the future the type possibly increases, and using if&#x2F;else if to extend the feature is not a good choice. <em>Replace Conditional with Polymorphism</em> is a better skill to refactor it. Before use polymorphism, should create a class and it contains amountFor and experienceFor functions.In StatementDataManager’s enrichTarget function, it calls amountFor and experienceFor, So I create a class HuntingTargetCalculator and use this class to call the 2 functions:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementDataManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;CalculatedTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = <span class="keyword">new</span> HuntingTargetCalculator(target);</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = monsterFor(result);</span><br><span class="line">result.Amount = amountFor(result);</span><br><span class="line">result.Experience = experienceFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> HuntingTarget _target;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingTargetCalculator</span>(<span class="params">HuntingTarget target</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">_target = target;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s create first property Monster in HuntingTargetCalculator. This property is passed by <strong><em>Change Function Declaration</em></strong> skill to mosterFor function. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementDataManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> monsters[missionTarget.MonsterId];</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = <span class="keyword">new</span> HuntingTargetCalculator(target, monsterFor(target));</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = calculator.Monster;</span><br><span class="line">result.Amount = amountFor(result);</span><br><span class="line">result.Experience = experienceFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> HuntingTarget _target;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">_target = target;</span><br><span class="line">Monster = monster;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring works. Next function is amountFor. Use _<strong>Move Function</strong>_to move its function body to HuntingTargetCalculator:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementDataManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, <span class="built_in">int</span>&gt; amountFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> HuntingTargetCalculator(missionTarget, monsterFor(missionTarget)).Amount;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = <span class="keyword">new</span> HuntingTargetCalculator(target, monsterFor(target));</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = calculator.Monster;</span><br><span class="line">result.Amount = amountFor(target);</span><br><span class="line">result.Experience = experienceFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> HuntingTarget _target;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Amount</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (Monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line">result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (_target.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (_target.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line">result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (_target.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (_target.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * _target.Level;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">$&quot;Unknown type: <span class="subst">&#123;Monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">_target = target;</span><br><span class="line">Monster = monster;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring works. Then use Inline Function skill to directly call the Amount get property and remove amountFor function of CreateStatementData:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;CalculatedTarget, <span class="built_in">int</span>&gt; experienceFor = <span class="built_in">delegate</span> (CalculatedTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = <span class="keyword">new</span> HuntingTargetCalculator(target, monsterFor(target));</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = calculator.Monster;</span><br><span class="line">result.Amount = calculator.Amount;</span><br><span class="line">result.Experience = experienceFor(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring works. I use the same skills to experienceFor function:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StatementDataManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = <span class="keyword">new</span> HuntingTargetCalculator(target, monsterFor(target));</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = calculator.Monster;</span><br><span class="line">result.Amount = calculator.Amount;</span><br><span class="line">result.Experience = calculator.Experience;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> HuntingTarget _target;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Amount</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> Experience</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(_target.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// add extra experience for every dragon monster by level dividing by 3</span></span><br><span class="line"><span class="keyword">if</span> (Monster.Type == <span class="string">&quot;dragon&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += _target.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HuntingTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring works.</p>
<h6 id="2-8-1-Making-the-HuntingTarget-Calculator-Polymorphic"><a href="#2-8-1-Making-the-HuntingTarget-Calculator-Polymorphic" class="headerlink" title="2.8.1 Making the HuntingTarget Calculator Polymorphic"></a>2.8.1 Making the HuntingTarget Calculator Polymorphic</h6><p>Use <strong><em>Replace Type Code with Subclasses</em></strong> to apply the polymorphism. Create a factory method CreateHuntingTargetCalculator to create a super class. It determine which subclass of HuntingTargetCalculator to be generated by monster type:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StatementData <span class="title">CreateStatementData</span>(<span class="params">HuntingMission mission, Dictionary&lt;<span class="built_in">string</span>, Monster&gt; monsters</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">Func&lt;HuntingTarget, Monster&gt; monsterFor = <span class="built_in">delegate</span> (HuntingTarget missionTarget)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;HuntingTarget, CalculatedTarget&gt; enrichTarget = <span class="built_in">delegate</span> (HuntingTarget target)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> calculator = CreateHuntingTargetCalculator(target, monsterFor(target));</span><br><span class="line">CalculatedTarget result = <span class="keyword">new</span> CalculatedTarget(target.MonsterId, target.Level);</span><br><span class="line">result.Monster = calculator.Monster;</span><br><span class="line">result.Amount = calculator.Amount;</span><br><span class="line">result.Experience = calculator.Experience;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalExperiences = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">Func&lt;StatementData, <span class="built_in">int</span>&gt; totalBonuses = <span class="built_in">delegate</span> (StatementData data)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line">StatementData statementData = <span class="keyword">new</span> StatementData();</span><br><span class="line">statementData.MissionName = mission.Name;</span><br><span class="line">statementData.Targets = mission.Targets.Select(enrichTarget).ToList();</span><br><span class="line">statementData.TotalBonuses = totalBonuses(statementData);</span><br><span class="line">statementData.TotalExperiences = totalExperiences(statementData);</span><br><span class="line"><span class="keyword">return</span> statementData;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> HuntingTargetCalculator <span class="title">CreateHuntingTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (monster.Type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;giant&quot;</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> GiantTargetCalculator(target, monster);</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dragon&quot;</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DragonTargetCalculator(target, monster);</span><br><span class="line"><span class="literal">default</span>:</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> ApplicationException(<span class="string">$&quot;Unknown type: <span class="subst">&#123;monster.Type&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I modify the HuntingTargetCalculator as an abstract class and this class updates the Amount &amp; Experience as virtual functions:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">readonly</span> HuntingTarget _target;</span><br><span class="line"><span class="keyword">public</span> Monster Monster &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> Amount &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">int</span> Experience</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">result += Math.Max(_target.Level - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">HuntingTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">_target = target;</span><br><span class="line">Monster = monster;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GiantTargetCalculator and DragonTargetCalculator inherit HuntingTargetCalculator. Let’s use Replace Conditional with Polymorphism skill to implement Amount&#x2F;Experience in those subclass:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">DragonTargetCalculator</span> : <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DragonTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>) : <span class="title">base</span>(<span class="params">target, monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Amount</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">80000</span>;</span><br><span class="line"><span class="keyword">if</span> (_target.Level &gt; <span class="number">35</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">2500</span> + <span class="number">900</span> * (_target.Level - <span class="number">35</span>);</span><br><span class="line">&#125;</span><br><span class="line">result += <span class="number">200</span> * _target.Level;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Experience</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">base</span>.Experience + _target.Level / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">GiantTargetCalculator</span> : <span class="title">HuntingTargetCalculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GiantTargetCalculator</span>(<span class="params">HuntingTarget target, Monster monster</span>) : <span class="title">base</span>(<span class="params">target, monster</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Amount</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> result = <span class="number">60000</span>;</span><br><span class="line"><span class="keyword">if</span> (_target.Level &gt; <span class="number">25</span>)</span><br><span class="line">&#123;</span><br><span class="line">result += <span class="number">500</span> * (_target.Level - <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compilation and testing, this refactoring works.</p>
<h4 id="3-Conclusions"><a href="#3-Conclusions" class="headerlink" title="3. Conclusions"></a>3. Conclusions</h4><p>I can’t believe that the original one function is changed into complex but very maintainable and readable functions&#x2F;structures. Following the chapter 1 of the book to get this result is very impressive!Let’s see that this example has three major evolution: </p>
<ol>
<li>Splitting a function into nested functions,</li>
<li>Split phase to separate the calculation and rendering code</li>
<li>Use polymorphism to process calculation</li>
</ol>
<p>The tip at book’s page 43 describes:</p>
<blockquote>
<p><em><strong>The true test of good code is how easy it is to change it</strong>.</em></p>
</blockquote>
<p>It’s also a ABSOLUTE TRUTH! I have learned classic 23 design patterns and applied them in some projects. Although these patterns were helpful to extend features, but I lacked some skills to decide when&#x2F;how I should refactor these patterns.This book provides many concepts to refactor those legacy codes. I think it should be read by every developer!<br>This example can be download in my <a target="_blank" rel="noopener" href="https://github.com/u8989332/martin-fowler-refactoring-2nd.git">Github repository</a></p>
<h4 id="4-References"><a href="#4-References" class="headerlink" title="4. References"></a>4. References</h4><p><a target="_blank" rel="noopener" href="https://draft.blogger.com/blog/post/edit/760085690055515370/8483927943229049666?hl=zh-TW#">Refactoring: Improving the Design of Existing Code (2nd Edition)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/09/home/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/09/home/" class="post-title-link" itemprop="url">Home</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-09 22:16:36" itemprop="dateCreated datePublished" datetime="2022-01-09T22:16:36+08:00">2022-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">208</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
