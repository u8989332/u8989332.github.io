<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="GeekCodeParadise">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="GeekCodeParadise">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="LiJyu Gao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>GeekCodeParadise</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">GeekCodeParadise</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/29/poeaa-domain-logic-pattern-domain-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/29/poeaa-domain-logic-pattern-domain-model/" class="post-title-link" itemprop="url">Domain Model Pattern</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-29 22:13:00" itemprop="dateCreated datePublished" datetime="2021-05-29T22:13:00+08:00">2021-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Design-Pattern/" itemprop="url" rel="index"><span itemprop="name">Design Pattern</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PoEAA/" itemprop="url" rel="index"><span itemprop="name">PoEAA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-What-is-Domain-Model"><a href="#1-What-is-Domain-Model" class="headerlink" title="1. What is Domain Model"></a>1. What is Domain Model</h3><p>According to [PoEAA], this definition is “A <strong>Domain Model</strong> creates a web of interconnected objects, where each object represents some meaningful individual, whether as large as a corporation or as small as a single line on an order form.”</p>
<p>This pattern has two kinds of type:</p>
<ol>
<li>Simple Domain Model: Every domain model can be mapped to one database table. Usually it uses Active Record.</li>
<li>Complex Domain Model: The model uses inheritance, strategies and other design patterns. Database can not directly map to the model. Using Data Mapper is required.</li>
</ol>
<h4 id="1-1-When-to-use-it"><a href="#1-1-When-to-use-it" class="headerlink" title="1.1 When to use it"></a>1.1 When to use it</h4><p>If the business layer is frequently changed and is gradually complex, using this pattern is a good choice. Creating Service Layer wraps the Domain Model to provide unified API for outer modules.</p>
<h3 id="2-Pattern-Practice-The-Revenue-Recognition-Problem"><a href="#2-Pattern-Practice-The-Revenue-Recognition-Problem" class="headerlink" title="2. Pattern Practice: The Revenue Recognition Problem"></a>2. Pattern Practice: The Revenue Recognition Problem</h3><p>This problem is introduced in the previous article <a target="_blank" rel="noopener" href="https://geekcodeparadise.com/2021/05/23/poeaa-domain-logic-pattern-transaction-script/">[PoEAA] Domain Logic Pattern - Transaction Script</a>. This article uses Domain Model to build the domain layer.</p>
<p>Define the classes for the revenue recognition, product and contract as the following figure:</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/25E6259C25AA25E5259125BD25E52590258D25E725BB259825E5259B25BE.png" alt="domain model classes for the revenue recognition, product and contract"></p>
<h4 id="2-1-Implementation-by-C"><a href="#2-1-Implementation-by-C" class="headerlink" title="2.1 Implementation by C#"></a>2.1 Implementation by C#</h4><p>This pattern is implemented by C#. Because the section <strong>Chapter 9 Domain Logic Pattern - Domain Model</strong> of PoEAA didn’t implement with database integration, this implementation don’t contain database example.</p>
<h5 id="2-1-1-Contract-Class-and-RevenueRecognition-Class"><a href="#2-1-1-Contract-Class-and-RevenueRecognition-Class" class="headerlink" title="2.1.1 Contract Class and RevenueRecognition Class"></a>2.1.1 Contract Class and RevenueRecognition Class</h5><p>For Contract class, it contains a Money object _<strong>revenue</strong> and a DateTime object <strong>_whenSigned</strong>. It also contains a list of <strong>RevenueRecognition</strong> which these recognitions belong to this contract.</p>
<p>class Contract<br>{<br>    private readonly List<RevenueRecognition> _revenueRecognitions &#x3D; new List<RevenueRecognition>();</p>
<pre><code>private readonly Product \_product;
private readonly Money \_revenue;
private readonly DateTime \_whenSigned;
private readonly int \_id;
private static int \_commonId = 1;
private static readonly object IdLock = new object();

public Contract(Product product, Money revenue, DateTime whenSigned)
&#123;
    \_product = product;
    \_revenue = revenue;
    \_whenSigned = whenSigned;
    \_id = GenerateNewId();
&#125;

private static int GenerateNewId()
&#123;
    // todo db generate auto increment id
    lock (IdLock)
    &#123;
        return \_commonId++;
    &#125;
&#125;

public Money RecognizedRevenue(DateTime asOf)
&#123;
    Money result = Money.Dollars(0m);
    \_revenueRecognitions.ForEach(x =&gt;
        &#123;
            if (x.IsRecognizableBy(asOf))
            &#123;
                result += x.GetAmount();
            &#125;
        &#125;);

    return result;
&#125;

public Money GetRevenue()
&#123;
    return \_revenue;
&#125;

public DateTime GetWhenSigned()
&#123;
    return \_whenSigned;
&#125;

public void AddRevenueRecognition(RevenueRecognition revenueRecognition)
&#123;
    // todo
    // db insert

    // after db insertion, add it to list
    \_revenueRecognitions.Add(revenueRecognition);
&#125;

public void CalculateRecognitions()
&#123;
    \_product.CalculateRevenueRecognitions(this);
&#125;
</code></pre>
<p>}</p>
<p>class RevenueRecognition<br>{<br>    private readonly Money _amount;<br>    private readonly DateTime _date;</p>
<pre><code>public RevenueRecognition(Money amount, DateTime date)
&#123;
    \_amount = amount;
    \_date = date;
&#125;

public Money GetAmount()
&#123;
    return \_amount;
&#125;

public bool IsRecognizableBy(DateTime asOf)
&#123;
    return asOf.CompareTo(\_date) &gt;= 0;
&#125;
</code></pre>
<p>}</p>
<h5 id="2-1-2-Product-Class-and-RecognitionStrategy-Class"><a href="#2-1-2-Product-Class-and-RecognitionStrategy-Class" class="headerlink" title="2.1.2 Product Class and RecognitionStrategy Class"></a>2.1.2 Product Class and RecognitionStrategy Class</h5><p>For Product class, it contains a name and associates a RecognitionStrategy instance:</p>
<p>class Product<br>{<br>    private readonly string _name;<br>    private readonly RecognitionStrategy _recognitionStrategy;</p>
<pre><code>public Product(string name, RecognitionStrategy recognitionStrategy)
&#123;
    \_name = name;
    \_recognitionStrategy = recognitionStrategy;
&#125;

public static Product NewWordProcessor(string name)
&#123;
    return new Product(name, new CompleteRecognitionStrategy());
&#125;

public static Product NewSpreadsheet(string name)
&#123;
    return new Product(name, new ThreeWayRecognitionStrategy(60, 90));
&#125;

public static Product NewDatabase(string name)
&#123;
    return new Product(name, new ThreeWayRecognitionStrategy(30, 60));
&#125;

public void CalculateRevenueRecognitions(Contract contract)
&#123;
    \_recognitionStrategy.CalculateRevenueRecognitions(contract);
&#125;
</code></pre>
<p>}</p>
<p>Previously a Transaction Script calculated the revenue recognitions in one service function. This Domain Model uses <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a> to bind Product instance with a RecognitionStrategy instance. The detail of calculating revenue recognition is implemented by the associated strategy.</p>
<p><strong>RecognitionStrategy</strong> is a base class that declare a abstract CalculateRevenueRecognitions function.</p>
<p><strong>CompleteRecognitionStrategy</strong> inherits from <strong>RecognitionStrategy</strong> and allocates all revenue in one date as same as Contract’s signed date.</p>
<p><strong>ThreeWayRecognitionStrategy</strong> also inherits from <strong>RecognitionStrategy</strong> and allocates revenue into 3 date.</p>
<p>abstract class RecognitionStrategy<br>{<br>public abstract void CalculateRevenueRecognitions(Contract contract);<br>}</p>
<p>class CompleteRecognitionStrategy : RecognitionStrategy<br>{<br>public override void CalculateRevenueRecognitions(Contract contract)<br>{<br>contract.AddRevenueRecognition(new RevenueRecognition(contract.GetRevenue(), contract.GetWhenSigned()));<br>}<br>}</p>
<p>class ThreeWayRecognitionStrategy : RecognitionStrategy<br>{<br>private readonly int _firstRecognitionOffset;<br>private readonly int _secondRecognitionOffset;</p>
<p>public ThreeWayRecognitionStrategy(int firstRecognitionOffset, int secondRecognitionOffset)<br>{<br>_firstRecognitionOffset &#x3D; firstRecognitionOffset;<br>_secondRecognitionOffset &#x3D; secondRecognitionOffset;<br>}</p>
<p>public override void CalculateRevenueRecognitions(Contract contract)<br>{<br>Money[] allocation &#x3D; contract.GetRevenue().Allocate(3);<br>contract.AddRevenueRecognition(new RevenueRecognition(allocation[0], contract.GetWhenSigned()));<br>contract.AddRevenueRecognition(new RevenueRecognition(allocation[1], contract.GetWhenSigned().AddDays(_firstRecognitionOffset)));<br>contract.AddRevenueRecognition(new RevenueRecognition(allocation[2], contract.GetWhenSigned().AddDays(_secondRecognitionOffset)));<br>}<br>}</p>
<h5 id="2-1-3-Demo"><a href="#2-1-3-Demo" class="headerlink" title="2.1.3 Demo"></a>2.1.3 Demo</h5><p>Create a console program and create 3 <strong>Products</strong> and <strong>3 Contracts</strong> to calculate the revenue recognitions for the 3 products.</p>
<p>As the following code:</p>
<p>Product word &#x3D; Product.NewWordProcessor(“CodeParadise Word”);<br>Product calc &#x3D; Product.NewSpreadsheet(“CodeParadise Calc”);<br>Product db &#x3D; Product.NewDatabase(“CodeParadise DB”);</p>
<p>Contract wordContract &#x3D; new Contract(word, Money.Dollars(24000m), new DateTime(2020, 7, 25));<br>Contract calcContract &#x3D; new Contract(calc, Money.Dollars(1000m), new DateTime(2020, 3, 15));<br>Contract dbContract &#x3D; new Contract(db, Money.Dollars(9999m), new DateTime(2020, 1, 1));</p>
<p>wordContract.CalculateRecognitions();<br>calcContract.CalculateRecognitions();<br>dbContract.CalculateRecognitions();</p>
<p>var wordProcessorRevenue &#x3D; wordContract.RecognizedRevenue(new DateTime(2020, 9, 30));<br>Console.WriteLine($”word processor revenue before 2020-09-30 &#x3D; {wordProcessorRevenue.Amount}”);</p>
<p>var spreadsheetRevenue &#x3D; calcContract.RecognizedRevenue(new DateTime(2020, 6, 1));<br>Console.WriteLine($”spreadsheet revenue before 2020-06-01 &#x3D; {spreadsheetRevenue.Amount}”);</p>
<p>var databaseRevenue &#x3D; dbContract.RecognizedRevenue(new DateTime(2020, 1, 25));<br>Console.WriteLine($”database revenue before 2020-01-25 &#x3D; {databaseRevenue.Amount}”);</p>
<p>The console shows:</p>
<p><a target="_blank" rel="noopener" href="http://geekcodeparadise.com/wp-content/uploads/2021/05/Untitled-3.png"><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/Untitled-2.png" alt="domain model result"></a></p>
<p>This result is the same as the Transaction Script example.</p>
<h3 id="3-Conclusions-for-Domain-Model"><a href="#3-Conclusions-for-Domain-Model" class="headerlink" title="3. Conclusions for Domain Model"></a>3. Conclusions for Domain Model</h3><p>This pattern is the necessary pattern for domain logic. It can be maintainable and testable for modern complex applications. If you are a .NET developer, Entity Framework or other popular ORMs have the concept of this pattern.</p>
<p>Usually a complex application not only uses this pattern to satisfy requirements, but also integrates other layers including presentation&#x2F;service&#x2F;persistence… Every layer is loosely coupled so the testing&#x2F;refactoring will be more liable than Transaction Script.</p>
<p>The above sample code is uploaded to this <a target="_blank" rel="noopener" href="https://github.com/u8989332/PoEAA_DomainModel">Github Repository</a>.</p>
<p>For next article I will write <strong>Table Module</strong> pattern according to <strong>Chapter 9 Domain Logic Pattern - Table Module</strong> of PoEAA.</p>
<h3 id="4-References"><a href="#4-References" class="headerlink" title="4. References"></a>4. References</h3><p><a target="_blank" rel="noopener" href="https://amzn.to/40CuWZT">Patterns of Enterprise Application Architecture Book(Amazon)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/23/poeaa-domain-logic-pattern-transaction-script/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/23/poeaa-domain-logic-pattern-transaction-script/" class="post-title-link" itemprop="url">Transaction Script Pattern</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-23 12:55:00" itemprop="dateCreated datePublished" datetime="2021-05-23T12:55:00+08:00">2021-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Design-Pattern/" itemprop="url" rel="index"><span itemprop="name">Design Pattern</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PoEAA/" itemprop="url" rel="index"><span itemprop="name">PoEAA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-What-is-Transaction-Script"><a href="#1-What-is-Transaction-Script" class="headerlink" title="1. What is Transaction Script"></a>1. What is Transaction Script</h3><p>According to [PoEAA], this definition is “A <strong>Transaction Script</strong> organizes all this logic primarily as a single procedure, making calls directly to the database or through a thin database wrapper.”</p>
<p>For example, when I buy a book on a ecommerce shop, the system executes a series of action, including receiving a book id and customer session, getting a book detail and customer detail from the database, and inserting an order into the database. These actions are organized in a transaction script.</p>
<p>Usually, a database transaction maps to a transaction script. So it is easily to implement data isolation.</p>
<h3 id="2-Pattern-Practice-The-Revenue-Recognition-Problem"><a href="#2-Pattern-Practice-The-Revenue-Recognition-Problem" class="headerlink" title="2. Pattern Practice: The Revenue Recognition Problem"></a>2. Pattern Practice: The Revenue Recognition Problem</h3><h4 id="2-1-Problem-Description"><a href="#2-1-Problem-Description" class="headerlink" title="2.1 Problem Description"></a>2.1 Problem Description</h4><p>In [PoEAA], the author wrote a simple case with this transaction script pattern. Assume a company that sells three kinds of software products: word processors, databases, and spreadsheets.</p>
<p>There are some revenue rules when you sign a contract with these products:</p>
<ol>
<li>For word processor, you can book all the revenue</li>
<li>For spreadsheet, you can book one-third today, one-third in sixty days, and one-third in ninety days</li>
<li>For database, you can book one-third today, one-third in thirty days, and one-third in sixty days</li>
</ol>
<p>Design 3 tables to record these data as Figure 1 shows.</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/classes-1.png" alt="Revenue Recognition Problem database design"></p>
<h4 id="2-2-Implementation-by-C-and-SQLite"><a href="#2-2-Implementation-by-C-and-SQLite" class="headerlink" title="2.2 Implementation by C# and SQLite"></a>2.2 Implementation by C# and SQLite</h4><p>This pattern is implemented by C# and database SQLite. SQLite is a very lightweight database to image our ideas.</p>
<p>Implementation is base on the section <strong>Chapter 9 Domain Logic Pattern - Transaction Script of PoEAA</strong>. </p>
<h5 id="2-2-1-Initialize-table-and-data"><a href="#2-2-1-Initialize-table-and-data" class="headerlink" title="2.2.1 Initialize table and data"></a>2.2.1 Initialize table and data</h5><p>When program starts running, it creates a SQLite file and the above 3 tables. The Create Table SQL:</p>
<p>CREATE TABLE Products (Id int primary key, Name TEXT, Type TEXT);<br>CREATE TABLE Contracts (Id int primary key, Product int, Revenue decimal, DateSigned date);<br>CREATE TABLE RevenueRecognitions (Contract int, Amount decimal, RecognizedOn date, PRIMARY KEY(Contract, RecognizedOn));</p>
<p>Insert 3 kinds of products as Figure 2 shows:</p>
<p><a target="_blank" rel="noopener" href="http://geekcodeparadise.com/wp-content/uploads/2021/05/products_data-2.png"><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/products_data-1.png" alt="Insert 3 products of Revenue Recognition Problem in Transaction Script "></a></p>
<p>Figure 2: Insert 3 products</p>
<p>Every product maps to a contract as Figure 3 shows:</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/Untitled-4.png" alt="Insert 3 contracts of Revenue Recognition Problem in Transaction Script "></p>
<p>Figure 3: Insert 3 contracts</p>
<h5 id="2-2-2-Table-Data-Gateway"><a href="#2-2-2-Table-Data-Gateway" class="headerlink" title="2.2.2 Table Data Gateway"></a>2.2.2 Table Data Gateway</h5><p>A <strong>table data gateway</strong> wraps the SQL queries. And this case is simple so the author creates only one Gateway class rather than one for each table.</p>
<p>The Gateway class has 3 functions to complete the above problem:</p>
<p>using CodeParadise.Money;<br>using System;<br>using System.Data;<br>using System.Data.SQLite;</p>
<p>namespace PoEAA_TransactionScript<br>{<br>    public class Gateway<br>    {<br>        private const string FindRecognitionsStatement &#x3D;<br>            @”<br>                SELECT Amount FROM RevenueRecognitions<br>                WHERE Contract &#x3D; $contractId AND RecognizedOn &lt;&#x3D; $beforeDate<br>            “;</p>
<pre><code>    private const string FindContractStatement =
        @&quot;
            SELECT \* FROM Contracts c, Products p 
            WHERE c.Id = $contractId AND c.product = p.Id
        &quot;;

    private const string InsertRecognitionsStatement =
        @&quot;
            INSERT INTO RevenueRecognitions VALUES ($contractId, $amount, $recognizedOn)
        &quot;;

    public DataTable FindRecognitionsFor(int contractId, DateTime beforeDate)
    &#123;
        var result = new DataTable();
        using var connection = DbManager.CreateConnection();
        connection.Open();
        var command = connection.CreateCommand();
        command.CommandText = FindRecognitionsStatement;
        command.Parameters.AddWithValue(&quot;$contractId&quot;, contractId);
        command.Parameters.AddWithValue(&quot;$beforeDate&quot;, beforeDate);

        using(var sqlDataAdapter = new SQLiteDataAdapter(command))
        &#123;
             sqlDataAdapter.Fill(result);
        &#125;
       
        return result;
    &#125;

    public DataTable FindContract(int contractId)
    &#123;
        var result = new DataTable();
        using var connection = DbManager.CreateConnection();
        connection.Open();
        var command = connection.CreateCommand();
        command.CommandText = FindContractStatement;
        command.Parameters.AddWithValue(&quot;$contractId&quot;, contractId);

        using(var sqlDataAdapter = new SQLiteDataAdapter(command))
        &#123;
             sqlDataAdapter.Fill(result);
        &#125;
       
        return result;
    &#125;

    public void InsertRecognitions(int contractId, Money amount, DateTime recognizedOn)
    &#123;
        using var connection = DbManager.CreateConnection();
        connection.Open();
        var command = connection.CreateCommand();
        command.CommandText = InsertRecognitionsStatement;
        command.Parameters.AddWithValue(&quot;$contractId&quot;, contractId);
        command.Parameters.AddWithValue(&quot;$amount&quot;, amount.Amount);
        command.Parameters.AddWithValue(&quot;$recognizedOn&quot;, recognizedOn);
        command.ExecuteNonQuery();
    &#125;
&#125;
</code></pre>
<p>}</p>
<p><strong>Money</strong> class is the implementation of the <strong>Money Pattern</strong> described in PoEAA. I created the project in this <a target="_blank" rel="noopener" href="https://github.com/u8989332/CodeParadise.Money">Github Repository</a> and published it to <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/CodeParadise.Money/">Nuget</a>. This class in this case is responsible for returning the money.</p>
<h5 id="2-2-3-Service"><a href="#2-2-3-Service" class="headerlink" title="2.2.3 Service"></a>2.2.3 Service</h5><p><strong>Service</strong> is responsible for business logic. So every service is thought as a transaction script.</p>
<p>The <strong>RecognitionService</strong> class has 2 functions:</p>
<p>using CodeParadise.Money;<br>using System;</p>
<p>namespace PoEAA_TransactionScript<br>{<br>    class RecognitionService<br>    {<br>        public Money RecognizedRevenue(int contractNumber, DateTime beforeDate)<br>        {<br>            Money result &#x3D; Money.Dollars(0m);<br>            Gateway db &#x3D; new Gateway();<br>            var dt &#x3D; db.FindRecognitionsFor(contractNumber, beforeDate);<br>            for (int i &#x3D; 0; i &lt; dt.Rows.Count; ++i)<br>            {<br>                var amount &#x3D; (decimal) dt.Rows[i][“Amount”];<br>                result +&#x3D; Money.Dollars(amount);<br>            }</p>
<pre><code>        return result;
    &#125;

    public void CalculateRevenueRecognitions(int contractId)
    &#123;
        Gateway db = new Gateway();
        var contracts = db.FindContract(contractId);
        Money totalRevenue = Money.Dollars((decimal) contracts.Rows\[0\]\[&quot;Revenue&quot;\]);
        DateTime recognitionDate = (DateTime) contracts.Rows\[0\]\[&quot;DateSigned&quot;\];
        string type = contracts.Rows\[0\]\[&quot;Type&quot;\].ToString();

        if(type == &quot;S&quot;)
        &#123;
            Money\[\] allocation = totalRevenue.Allocate(3);
            db.InsertRecognitions(contractId, allocation\[0\], recognitionDate);
            db.InsertRecognitions(contractId, allocation\[1\], recognitionDate.AddDays(60));
            db.InsertRecognitions(contractId, allocation\[2\], recognitionDate.AddDays(90));
        &#125;
        else if(type == &quot;W&quot;)
        &#123;
            db.InsertRecognitions(contractId, totalRevenue, recognitionDate);
        &#125;
        else if(type == &quot;D&quot;)
        &#123;
            Money\[\] allocation = totalRevenue.Allocate(3);
            db.InsertRecognitions(contractId, allocation\[0\], recognitionDate);
            db.InsertRecognitions(contractId, allocation\[1\], recognitionDate.AddDays(30));
            db.InsertRecognitions(contractId, allocation\[2\], recognitionDate.AddDays(60));
        &#125;
    &#125;
&#125;
</code></pre>
<p>}</p>
<p><strong>CalculateRevenueRecognitions</strong> function is calculating the revenue recognitions on an existing contract. <strong>RecognizedRevenue</strong> function sum the amounts based on the contract id and the recognized date. These services functions are based on the result sets from <strong>Gateway</strong> class and implement their business logics.</p>
<h5 id="2-2-4-Demo"><a href="#2-2-4-Demo" class="headerlink" title="2.2.4 Demo"></a>2.2.4 Demo</h5><p>Create a console program and create a <strong>RecognitionService</strong> to calculate the revenue recognitions for the 3 products.</p>
<p>As the following code:</p>
<p>RecognitionService service &#x3D; new RecognitionService();</p>
<p>&#x2F;&#x2F; database product<br>service.CalculateRevenueRecognitions(1);<br>var databaseRevenue &#x3D; service.RecognizedRevenue(1, new System.DateTime(2020, 1, 25));<br>Console.WriteLine($”database revenue before 2020-01-25 &#x3D; {databaseRevenue.Amount}”);</p>
<p>&#x2F;&#x2F; spreadsheet product<br>service.CalculateRevenueRecognitions(2);<br>var spreadsheetRevenue &#x3D; service.RecognizedRevenue(2, new System.DateTime(2020, 6, 1));<br>Console.WriteLine($”spreadsheet revenue before 2020-06-01 &#x3D; {spreadsheetRevenue.Amount}”);</p>
<p> &#x2F;&#x2F; word processor product<br>service.CalculateRevenueRecognitions(3);<br>var wordProcessorRevenue &#x3D; service.RecognizedRevenue(3, new System.DateTime(2020, 9, 30));<br>Console.WriteLine($”word processor revenue before 2020-09-30 &#x3D; {wordProcessorRevenue.Amount}”);</p>
<p>The console shows:</p>
<p><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/Untitled2B1.png" alt="Transaction Script result"></p>
<p>Let’s look at the table <strong>RevenueRecognitions of</strong> the the database, and it’s records are inserted by <strong>CalculateRevenueRecognitions</strong> function.</p>
<p><a target="_blank" rel="noopener" href="https://www.blogger.com/#"><img src="http://geekcodeparadise.com/wp-content/uploads/2021/05/Untitled2B2.png" alt="Calculated revenue recognitions for 3 contracts in Transaction Script "></a></p>
<p>Figure 5: Calculated revenue recognitions for 3 contracts</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>3. Conclusions for Transaction Script</p>
<p>Everybody can write “Transaction Scripts”. Yes, it’s just a script. If the business logic is very simple, just use this pattern. For complex applications, Transaction Script is not maintainable. Even one service function that contains hundreds of &#x2F; thousands of code lines is the nightmare for developers.</p>
<p>The above sample code is uploaded to this <a target="_blank" rel="noopener" href="https://github.com/u8989332/PoEAA_TransactionScript">Github Repository</a>.</p>
<p>For next article I will write <strong>Domain Model</strong> pattern. It’s more complex but maintainable for complex applications. Modern .NET solution with Entity Framework is based on <strong>Domain Model.</strong> Some developers have silently used this pattern but I want to dive in this classic concept.</p>
<p>Although I have developed .NET software for some years and almost read the documents with MSDN, the classic concepts of patterns&#x2F;architecture are organized by Martin Fowler. PoEAA is a masterpiece that every programmer should read. Despite of 20 years past, it is still valuable for modern software.</p>
<h3 id="4-References"><a href="#4-References" class="headerlink" title="4. References"></a>4. References</h3><p><a target="_blank" rel="noopener" href="https://amzn.to/40CuWZT">Patterns of Enterprise Application Architecture Book(Amazon)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/12/wpf-instagram-clone-layout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/wpf-instagram-clone-layout/" class="post-title-link" itemprop="url">[WPF] Instagram Clone Layout</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-12 23:54:00" itemprop="dateCreated datePublished" datetime="2021-01-12T23:54:00+08:00">2021-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WPF/" itemprop="url" rel="index"><span itemprop="name">WPF</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>        嘗試用.NET 5開發WPF專案，模仿Instagram Web (PC瀏覽)的版面，沒有任何真正Instagram的功能。程式碼放在<a target="_blank" rel="noopener" href="https://github.com/u8989332/Instagram_Layout_Clone_WPF">我的Github</a>，歡迎參觀～</p>
<p><a target="_blank" rel="noopener" href="http://geekcodeparadise.com/wp-content/uploads/2021/01/Result.png"><img src="http://geekcodeparadise.com/wp-content/uploads/2021/01/Result.png"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/29/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C-shaun-t%E7%9A%84-insanity-2%E5%91%A8-focus-t25-4%E5%91%A8%E7%9A%84%E6%88%90%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/29/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C-shaun-t%E7%9A%84-insanity-2%E5%91%A8-focus-t25-4%E5%91%A8%E7%9A%84%E6%88%90%E6%9E%9C/" class="post-title-link" itemprop="url">[減肥日誌] Shaun T的 Insanity 2周 + Focus T25 4周的成果</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-29 20:20:00" itemprop="dateCreated datePublished" datetime="2020-11-29T20:20:00+08:00">2020-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C/" itemprop="url" rel="index"><span itemprop="name">減肥日誌</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>上次做Insantiy的4周的文章: <a target="_blank" rel="noopener" href="https://geekcodeparadise.com/2020/10/18/%e6%b8%9b%e8%82%a5%e6%97%a5%e8%aa%8c-shaun-t%e7%9a%84-insanity-4%e5%91%a8%e7%9a%84%e6%88%90%e6%9e%9c/">https://geekcodeparadise.com/2020/10/18/%e6%b8%9b%e8%82%a5%e6%97%a5%e8%aa%8c-shaun-t%e7%9a%84-insanity-4%e5%91%a8%e7%9a%84%e6%88%90%e6%9e%9c/</a></p>
<p>從2020&#x2F;10&#x2F;19，開始<a target="_blank" rel="noopener" href="https://amzn.to/42Exybx">實施Shaun T的Insanity後半部訓練課程</a>，其中第1周是會喘的拉伸動作，其目的是讓身體能適應第2個月的Insanity。</p>
<p>第2周是名稱以Max開頭的訓練課程，每個都快1小時，那個疲累程度真的是喘到Ｏ北，每天做完都有一種人已經快升天的感覺．．．每一種動作都很愛跳，跳，跳乎伊勇～跳，跳，跳甲要起瘋～～～(By LA BOYZ的跳)</p>
<p>原本第3周一樣跳Insanity，結果預料之中的疾病：膝蓋痠痛　開始發作，直覺是不能再繼續跳Insanity，於是改回跳Focus T25的Gamma，畢竟Gamma的跳動作比較少，很多動作是搭配啞鈴重訓，讓膝蓋的痛舒緩很多～且原本課表是跳周1至周5，我改成周6也跳。</p>
<p>到今天共6周的身材變化，體重變成91.3公斤，腰圍仍是38.5吋，而最令人心動十分的成果是，體脂率降到26% !!!!!從去年的33% -&gt; 26%，離男性正常的15%~25%很接近了!!從今年6月到現在共24周的付出沒有白費，實在可喜可賀。</p>
<p>體重和腰圍維持差不多的數值已3周，正在考慮換Insanity Max 30，它的時間一樣短且強度比Focus T25高，也許能讓身體數值有更好的成果，期待下次的減肥成果文吧～</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/29/leetcode-8-string-to-integer-atoi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/29/leetcode-8-string-to-integer-atoi/" class="post-title-link" itemprop="url">LeetCode 8 String to Integer (atoi)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-29 16:07:00" itemprop="dateCreated datePublished" datetime="2020-10-29T16:07:00+08:00">2020-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Level-Medium/" itemprop="url" rel="index"><span itemprop="name">Level-Medium</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A8%8B%E5%BC%8F%E8%A7%A3%E9%A1%8C/" itemprop="url" rel="index"><span itemprop="name">程式解題</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramSolving/" itemprop="url" rel="index"><span itemprop="name">ProgramSolving</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>LeetCode - 8 String to Integer (atoi) 解題報告</p>
<h4 id="平台："><a href="#平台：" class="headerlink" title="平台："></a>平台：</h4><p>LeetCode</p>
<h4 id="題號："><a href="#題號：" class="headerlink" title="題號："></a>題號：</h4><p>8 - String to Integer (atoi)</p>
<h4 id="題目連結："><a href="#題目連結：" class="headerlink" title="題目連結："></a>題目連結：</h4><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/valid-palindrome/">https://leetcode.com/problems/valid-palindrome/</a></p>
<h4 id="題目說明："><a href="#題目說明：" class="headerlink" title="題目說明："></a>題目說明：</h4><p>給1個字串s，實作atoi函式，將此字串轉成整數。字串裡可能包含多個非數字字元，像是+號、-號、空白、非數字等。前面遇到空白都略過，直到第一個非空白字元。接著有可選的+號字元或者-號，後面可能接著數字或者其他字元。</p>
<p>在數字之後的其他字元就都排除不理。</p>
<p>如果在空白字元之後的字串，沒有合理的數字或者是空字串或者只有空白，則回傳0。</p>
<p>解析後的數字如果超出32位元整數的上限&#x2F;下限，則回傳32位元整數的上限&#x2F;下限。</p>
<p>比如範例輸入s &#x3D; “   -42”，回傳-42</p>
<p>s &#x3D; “4193 with words”，4193後出現非數字字元，所以只需解析前面的數字，回傳4193</p>
<p>s &#x3D; “words and 987”，一開始出現非數字字元，屬於非合理的數字，回傳0</p>
<p>s &#x3D; “-91283472332”，低於32位元整數的下限，所以回傳32位元整數的下限-2147483648</p>
<h4 id="解題方法："><a href="#解題方法：" class="headerlink" title="解題方法："></a>解題方法：</h4><p>有2階段的處理流程，第1階段是解析該字串前面是否有無效的整數規則，如下圖1的解析流程。</p>
<p><img src="https://geekcodeparadise.com/wp-content/uploads/2021/12/Untitled_Diagram.png" alt="LeetCode 8 String to Integer (atoi) solution"></p>
<p>圖1</p>
<p>第2階段是前面得知是正數或負數，用64位元變數做進位計算，直到字串讀到結尾或者非數字。再判斷long變數有無超出32位元整數的上限&#x2F;下限。最後回傳轉型32位元整數。</p>
<p>難度為Medium  </p>
<h4 id="GITHUB位置-C-與-C-："><a href="#GITHUB位置-C-與-C-：" class="headerlink" title="GITHUB位置(C++ 與 C#)："></a>GITHUB位置(C++ 與 C#)：</h4><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/1-99/8.cpp">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/1-99/8.cpp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/1-99/8.cs">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/1-99/8.cs</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/18/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C-shaun-t%E7%9A%84-insanity-4%E5%91%A8%E7%9A%84%E6%88%90%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/18/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C-shaun-t%E7%9A%84-insanity-4%E5%91%A8%E7%9A%84%E6%88%90%E6%9E%9C/" class="post-title-link" itemprop="url">[減肥日誌] Shaun T的 Insanity 4周的成果</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-18 11:05:00" itemprop="dateCreated datePublished" datetime="2020-10-18T11:05:00+08:00">2020-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%9B%E8%82%A5%E6%97%A5%E8%AA%8C/" itemprop="url" rel="index"><span itemprop="name">減肥日誌</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>上次做Focus T25的14周的文章: <a target="_blank" rel="noopener" href="https://geekcodeparadise.com/2020/09/13/%e6%b8%9b%e8%82%a5%e6%97%a5%e8%aa%8c-shaun-t%e7%9a%84-focus-t25-14%e5%91%a8%e7%9a%84%e6%88%90%e6%9e%9c/">https://geekcodeparadise.com/2020/09/13/%e6%b8%9b%e8%82%a5%e6%97%a5%e8%aa%8c-shaun-t%e7%9a%84-focus-t25-14%e5%91%a8%e7%9a%84%e6%88%90%e6%9e%9c/</a></p>
<p>從2020&#x2F;9&#x2F;21，開始實施<a target="_blank" rel="noopener" href="https://amzn.to/42Exybx">Shaun T的Insanity訓練課程</a>，來看看這課程的精美廣告</p>
<p>課程主打60天(9周)的運動效果，也是幾乎每個學員身材變壯、變瘦，令人心動十分。這個課程比Focus T25還有名，有刷脂神器的稱號，<a target="_blank" rel="noopener" href="https://amzn.to/42Exybx">在Amazon上有4千多的評論</a>，蠻值得參考。</p>
<p>Insanity的訓練方式和Focus T25差很多，他約有10分鐘的激烈熱身、8分鐘動態伸展、20分鐘真正的HIIT動作，最後5分鐘收操，光是前面的激烈熱身就讓人滿頭汗。後面的HIIT動作，目前沒有一次完整做完，太操了……很多需要伏地挺身接著平板踢腿又要站起來又趴下去繼續做，後面腿都會軟掉XD</p>
<p>還好前面有經過Focus T25的14周訓練，讓我建立基礎的體能，否則可能做完第一周的Insanity，肌肉就痛到休養好幾天。</p>
<p>到今天共4周的身材變化，體重變成92公斤，腰圍瘦成38.5吋！又再次的進步！感到體能變最多的是，開合跳的速度可以超快，這應該是有史以來我跳最快的開合跳XD 但有隱憂的是膝蓋會不舒服QQ，有1~2次膝蓋不舒服就做得很差，所以要用這課程的人，需評估好身體狀況。</p>
<p>上次目標是36吋腰圍，但還太早了，還有5周且又更強的課程等著去完成，希望下次發文又是進步的成果～</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/14/leetcode-125-valid-palindrome/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/14/leetcode-125-valid-palindrome/" class="post-title-link" itemprop="url">LeetCode 125 Valid Palindrome</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-14 09:39:00" itemprop="dateCreated datePublished" datetime="2020-10-14T09:39:00+08:00">2020-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Level-Easy/" itemprop="url" rel="index"><span itemprop="name">Level-Easy</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A8%8B%E5%BC%8F%E8%A7%A3%E9%A1%8C/" itemprop="url" rel="index"><span itemprop="name">程式解題</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramSolving/" itemprop="url" rel="index"><span itemprop="name">ProgramSolving</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>LeetCode 125 Valid Palindrome 解題報告</p>
<h4 id="平台："><a href="#平台：" class="headerlink" title="平台："></a>平台：</h4><p>LeetCode</p>
<h4 id="題號："><a href="#題號：" class="headerlink" title="題號："></a>題號：</h4><p>125 - Valid Palindrome</p>
<h4 id="題目連結："><a href="#題目連結：" class="headerlink" title="題目連結："></a>題目連結：</h4><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/valid-palindrome/">https://leetcode.com/problems/valid-palindrome/</a></p>
<h4 id="題目說明："><a href="#題目說明：" class="headerlink" title="題目說明："></a>題目說明：</h4><p>給1個字串s，求s是否為s的palindrome(回文)，這題的Palindrome的定義是字串的英文字母和數字是左右對稱，且英文大小寫不分，如果是其他字元則略過不比對。</p>
<p>比如範例輸入s &#x3D; “A man, a plan, a canal: Panama”，它扣掉空白、逗號、分號，全轉成小寫的話，會是”amanaplanacanalpanama”，會是左右對稱的回文。</p>
<p>特殊案例是 s &#x3D; “,!”，全都只有標點符號，這也是回文。</p>
<h4 id="解題方法："><a href="#解題方法：" class="headerlink" title="解題方法："></a>解題方法：</h4><p>建立2個索引值i和j，分別從字串s的左邊和右邊掃描，找到第1個英文字母或數字則停下，確認是否符合回文定義的比對規則，如果不相同，則並不是回文。當i &gt;&#x3D; j，代表已經都比對完，則屬於回文。 而判斷是否相同字母或數字，可以用字元的ASCII範圍檢查，並回傳自定義的索引值，比如’A’和’a’回傳0、’0’回傳26(與前面英文字母不同)。</p>
<p>難度為Easy  </p>
<h4 id="GITHUB位置-C-與-C-："><a href="#GITHUB位置-C-與-C-：" class="headerlink" title="GITHUB位置(C++ 與 C#)："></a>GITHUB位置(C++ 與 C#)：</h4><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/100-199/125.cpp">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/100-199/125.cpp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/100-199/125.cs">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/100-199/125.cs</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/14/%E4%B8%80%E8%A2%8B-net%E8%A6%81%E6%89%9B%E5%B9%BE%E6%A8%93%EF%BC%9F%E6%89%93%E9%80%A0%E5%AE%B9%E5%99%A8%E5%8C%96%E7%9A%84asp-net-core%E7%B6%B2%E7%AB%99%EF%BC%81%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/14/%E4%B8%80%E8%A2%8B-net%E8%A6%81%E6%89%9B%E5%B9%BE%E6%A8%93%EF%BC%9F%E6%89%93%E9%80%A0%E5%AE%B9%E5%99%A8%E5%8C%96%E7%9A%84asp-net-core%E7%B6%B2%E7%AB%99%EF%BC%81%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" class="post-title-link" itemprop="url">一袋.NET要扛幾樓？打造容器化的ASP.NET Core網站！系列文章 - (28) 建立購物車系統 - 11</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-14 07:30:00" itemprop="dateCreated datePublished" datetime="2020-10-14T07:30:00+08:00">2020-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ASP-NET-Core/" itemprop="url" rel="index"><span itemprop="name">ASP.NET Core</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-在WebMvc專案新增購物車服務的功能"><a href="#1-在WebMvc專案新增購物車服務的功能" class="headerlink" title="1. 在WebMvc專案新增購物車服務的功能"></a>1. 在WebMvc專案新增購物車服務的功能</h1><h2 id="1-1-修改-LoginPartial-cshtml"><a href="#1-1-修改-LoginPartial-cshtml" class="headerlink" title="1.1 修改_LoginPartial.cshtml"></a>1.1 修改_LoginPartial.cshtml</h2><p>在網站登入後，要增加購物車Cart ViewComponent，需修改_LoginPartial.cshtml：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@using WebMvc.Services@inject IAuthService&lt;ApplicationUser&gt; UserManager@if (User?.Identity?.IsAuthenticated == true)&#123;    &lt;li&gt;        @User.FindFirst(x =&gt; x.Type == &quot;preferred_username&quot;).Value    &lt;/li&gt;    &lt;li&gt;        @await Component.InvokeAsync(&quot;Cart&quot;, new &#123; user = UserManager.Get(User) &#125;)    &lt;/li&gt;    &lt;li class=&quot;pull-right&quot;&gt;        &lt;form asp-area=&quot;&quot; asp-controller=&quot;Account&quot; asp-action=&quot;SignOut&quot; method=&quot;post&quot; id=&quot;logoutForm&quot;&gt;            &lt;a href=&quot;javascript:document.getElementById(&#x27;logoutForm&#x27;).submit()&quot;&gt;                Log Out            &lt;/a&gt;        &lt;/form&gt;    &lt;/li&gt;&#125;else&#123;    &lt;li&gt;        &lt;a asp-area=&quot;&quot; asp-controller=&quot;Account&quot; asp-action=&quot;SignIn&quot;&gt;            Login        &lt;/a&gt;    &lt;/li&gt;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-新增ViewComponent-Cart的頁面"><a href="#1-2-新增ViewComponent-Cart的頁面" class="headerlink" title="1.2 新增ViewComponent Cart的頁面"></a>1.2 新增ViewComponent Cart的頁面</h2><p>在Views&#x2F;Shared的目錄，新增Components目錄，再新增Cart目錄，最後加上Default.cshtml，也就是之前繼承ViewComponent的Cart.cs會回傳的頁面，主要是顯示購物車的數量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@model WebMvc.ViewModels.CartComponentViewModel@&#123;     ViewData[&quot;Title&quot;] = &quot;My Cart&quot;;&#125;&lt;a class=&quot;@Model.Disabled&quot; asp-area=&quot;&quot; asp-controller=&quot;Cart&quot; asp-action=&quot;Index&quot;&gt;    @if (ViewBag.IsCartInoperative == true)    &#123;        &lt;p class=&quot;fa fa-2x fa-shopping-cart&quot;&gt;X&lt;/p&gt;    &#125;    else    &#123;        &lt;p class=&quot;fa fa-2x fa-shopping-cart&quot;&gt;@Model.ItemsInCart&lt;/p&gt;    &#125;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/13/leetcode-242-valid-anagram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/13/leetcode-242-valid-anagram/" class="post-title-link" itemprop="url">LeetCode 242 Valid Anagram</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-13 22:11:00" itemprop="dateCreated datePublished" datetime="2020-10-13T22:11:00+08:00">2020-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Level-Easy/" itemprop="url" rel="index"><span itemprop="name">Level-Easy</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A8%8B%E5%BC%8F%E8%A7%A3%E9%A1%8C/" itemprop="url" rel="index"><span itemprop="name">程式解題</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramSolving/" itemprop="url" rel="index"><span itemprop="name">ProgramSolving</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>LeetCode - 242 Valid Anagram 解題報告</p>
<h4 id="平台："><a href="#平台：" class="headerlink" title="平台："></a>平台：</h4><p>LeetCode</p>
<h4 id="題號："><a href="#題號：" class="headerlink" title="題號："></a>題號：</h4><p>242 - Valid Anagram</p>
<h4 id="題目連結："><a href="#題目連結：" class="headerlink" title="題目連結："></a>題目連結：</h4><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/valid-anagram/">https://leetcode.com/problems/valid-anagram/</a></p>
<h4 id="題目說明："><a href="#題目說明：" class="headerlink" title="題目說明："></a>題目說明：</h4><p>給2個字串s和t，求t是否為s的anagram，anagram的定義是一個字串的字母經過不同的排列組合，形成另一個字串。題目保證只有小寫英文字母。</p>
<p>比如範例輸入s &#x3D; “anagram”, t &#x3D; “nagaram”，它們彼此是anagram；但s &#x3D; “rat”, t &#x3D; “car”，並不是anagram，因為t沒有s的r字母、且多了c字母。</p>
<h4 id="解題方法："><a href="#解題方法：" class="headerlink" title="解題方法："></a>解題方法：</h4><p>建立2個陣列，分別記錄s和t每個a-z字母出現的次數，最後再比對這2個陣列a-z的次數是否相同，相同則代表是anagram。</p>
<p>難度為Easy  </p>
<h4 id="GITHUB位置-C-與-C-："><a href="#GITHUB位置-C-與-C-：" class="headerlink" title="GITHUB位置(C++ 與 C#)："></a>GITHUB位置(C++ 與 C#)：</h4><p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/200-299/242.cpp">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%2B%2B/200-299/242.cpp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/200-299/242.cs">https://github.com/u8989332/ProblemSolving/blob/master/LeetCode/C%23/200-299/242.cs</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/12/%E4%B8%80%E8%A2%8B-net%E8%A6%81%E6%89%9B%E5%B9%BE%E6%A8%93%EF%BC%9F%E6%89%93%E9%80%A0%E5%AE%B9%E5%99%A8%E5%8C%96%E7%9A%84asp-net-core%E7%B6%B2%E7%AB%99%EF%BC%81%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiJyu Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekCodeParadise">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/12/%E4%B8%80%E8%A2%8B-net%E8%A6%81%E6%89%9B%E5%B9%BE%E6%A8%93%EF%BC%9F%E6%89%93%E9%80%A0%E5%AE%B9%E5%99%A8%E5%8C%96%E7%9A%84asp-net-core%E7%B6%B2%E7%AB%99%EF%BC%81%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0-2/" class="post-title-link" itemprop="url">一袋.NET要扛幾樓？打造容器化的ASP.NET Core網站！系列文章 - (27) 建立購物車系統 - 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-12 23:58:00" itemprop="dateCreated datePublished" datetime="2020-10-12T23:58:00+08:00">2020-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-19 15:47:25" itemprop="dateModified" datetime="2023-11-19T15:47:25+08:00">2023-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ASP-NET-Core/" itemprop="url" rel="index"><span itemprop="name">ASP.NET Core</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-在WebMvc專案新增購物車服務的功能"><a href="#1-在WebMvc專案新增購物車服務的功能" class="headerlink" title="1. 在WebMvc專案新增購物車服務的功能"></a>1. 在WebMvc專案新增購物車服務的功能</h1><h2 id="1-1-修改appSettings-json"><a href="#1-1-修改appSettings-json" class="headerlink" title="1.1 修改appSettings.json"></a>1.1 修改appSettings.json</h2><p>在WebMvc專案的appSettings.json增加購物車服務的Api連結：</p>
<p>  “CartUrl”: “<a target="_blank" rel="noopener" href="http://localhost:1028/">http://localhost:1028</a>“,</p>
<h2 id="1-2-修改Startup-cs類別"><a href="#1-2-修改Startup-cs類別" class="headerlink" title="1.2 修改Startup.cs類別"></a>1.2 修改Startup.cs類別</h2><p>修改WebMvc專案的Startup.cs，主要是增加在OIDC的購物車Scope、註冊購物車相關服務：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Authentication.Cookies;using Microsoft.AspNetCore.Authentication.OpenIdConnect;using Microsoft.AspNetCore.Builder;using Microsoft.AspNetCore.Hosting;using Microsoft.AspNetCore.Http;using Microsoft.Extensions.Configuration;using Microsoft.Extensions.DependencyInjection;using Microsoft.Extensions.Hosting;using Newtonsoft.Json.Serialization;using System.IdentityModel.Tokens.Jwt;using System.Net.Http;using WebMvc.Infrastructure;using WebMvc.Models;using WebMvc.Services;namespace WebMvc&#123;    public class Startup    &#123;        public Startup(IConfiguration configuration)        &#123;            Configuration = configuration;        &#125;        public IConfiguration Configuration &#123; get; &#125;        // This method gets called by the runtime. Use this method to add services to the container.        public void ConfigureServices(IServiceCollection services)        &#123;            services.Configure&lt;AppSettings&gt;(Configuration);            services.AddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;();            services.AddSingleton&lt;IHttpClient, CustomHttpClient&gt;();            services.AddTransient&lt;ICatalogService, CatalogService&gt;();            services.AddTransient&lt;IAuthService&lt;ApplicationUser&gt;, AuthService&gt;();            services.AddTransient&lt;ICartService, CartService&gt;();            services.AddControllersWithViews().AddNewtonsoftJson(options =&gt;            &#123;                options.SerializerSettings.ContractResolver = new CamelCasePropertyNamesContractResolver();                options.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore;            &#125;);            JwtSecurityTokenHandler.DefaultMapInboundClaims = false;            var identityUrl = Configuration.GetValue&lt;string&gt;(&quot;IdentityUrl&quot;);            var callBackUrl = Configuration.GetValue&lt;string&gt;(&quot;CallBackUrl&quot;);            services.AddAuthentication(options =&gt;            &#123;                options.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;                options.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;            &#125;)            .AddCookie(CookieAuthenticationDefaults.AuthenticationScheme)            .AddOpenIdConnect(OpenIdConnectDefaults.AuthenticationScheme, options =&gt;            &#123;                options.SignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;                options.Authority = identityUrl;                options.SignedOutRedirectUri = callBackUrl;                options.ClientId = &quot;mvc&quot;;                options.ClientSecret = &quot;secret&quot;;                options.ResponseType = &quot;code id_token&quot;;                options.SaveTokens = true;                options.GetClaimsFromUserInfoEndpoint = true;                options.RequireHttpsMetadata = false;                options.Scope.Add(&quot;openid&quot;);                options.Scope.Add(&quot;profile&quot;);                options.Scope.Add(&quot;offline_access&quot;);                options.Scope.Add(&quot;basket&quot;);                options.NonceCookie.SameSite = SameSiteMode.Lax;                options.CorrelationCookie.SameSite = SameSiteMode.Lax;                options.BackchannelHttpHandler = new HttpClientHandler()                &#123;                    ServerCertificateCustomValidationCallback = HttpClientHandler.DangerousAcceptAnyServerCertificateValidator                &#125;;            &#125;);        &#125;        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)        &#123;            if (env.IsDevelopment())            &#123;                app.UseDeveloperExceptionPage();            &#125;            else            &#123;                app.UseExceptionHandler(&quot;/Home/Error&quot;);            &#125;            app.UseStaticFiles();            app.UseRouting();            app.UseAuthentication();            app.UseAuthorization();            app.UseEndpoints(endpoints =&gt;            &#123;                endpoints.MapControllerRoute(                    name: &quot;default&quot;,                    pattern: &quot;&#123;controller=Catalog&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;);            &#125;);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="1-3-新增Cart和CartList的ViewComponent"><a href="#1-3-新增Cart和CartList的ViewComponent" class="headerlink" title="1.3 新增Cart和CartList的ViewComponent"></a>1.3 新增Cart和CartList的ViewComponent</h2><p>在WebMvc專案新增ViewComponents資料夾，並新增Cart.cs和CartList.cs 2個類別，都實作Microsoft.AspNetCore.Mvc.ViewComponent，之後Views的cshtml可以直接把它們當function呼叫並產生子View：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;using System;using System.Threading.Tasks;using WebMvc.Models;using WebMvc.Services;using WebMvc.ViewModels;namespace WebMvc.ViewComponents&#123;    public class Cart : ViewComponent    &#123;        private readonly ICartService _cartService;        public Cart(ICartService cartService)        &#123;            _cartService = cartService;        &#125;        public async Task&lt;IViewComponentResult&gt; InvokeAsync(ApplicationUser user)        &#123;            var vm = new CartComponentViewModel();            try            &#123;                var cart = await _cartService.GetCartAsync(user);                vm.ItemsInCart = cart.Items.Count;                vm.TotalCost = cart.Total();                return View(vm);            &#125;            catch (Exception)            &#123;                ViewBag.IsCartInoperative = true;            &#125;            return View(vm);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;using System;using System.Threading.Tasks;using WebMvc.Models;using WebMvc.Services;namespace WebMvc.ViewComponents&#123;    public class CartList : ViewComponent    &#123;        private readonly ICartService _cartService;        public CartList(ICartService cartService)        &#123;            _cartService = cartService;        &#125;        public async Task&lt;IViewComponentResult&gt; InvokeAsync(ApplicationUser user)        &#123;            var vm = new Models.CartModels.Cart();            try            &#123;                vm = await _cartService.GetCartAsync(user);                return View(vm);            &#125;            catch (Exception)            &#123;                ViewBag.IsCartInoperative = true;                TempData[&quot;CartInoperativeMsg&quot;] = &quot;Cart Service is inoperative, please retry later.&quot;;            &#125;            return View(vm);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.4 新增CartComponentViewModel類別在WebMvc專案的ViewModels新增CartComponentViewModel.cs，是Cart ViewComponent要回傳的View：namespace WebMvc.ViewModels&#123;    public class CartComponentViewModel    &#123;        public int ItemsInCart &#123; get; set; &#125;        public decimal TotalCost &#123; get; set; &#125;        public string Disabled =&gt; (ItemsInCart == 0) ? &quot;is-disabled&quot; : &quot;&quot;;    &#125;&#125; </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LiJyu Gao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">206</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiJyu Gao</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
